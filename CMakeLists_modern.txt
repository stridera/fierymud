# Modern FieryMUD Server - Separate Build
# This is a completely separate build system for the modern server
# to avoid any conflicts with legacy code.

cmake_minimum_required(VERSION 3.20)
project(modern_fierymud VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Modern-only source files - no legacy dependencies
set(MODERN_SOURCES
    # Main entry point
    src/modern_main.cpp
    
    # Modern game logic - clean Actor hierarchy
    src/modern/game/actor.cpp
    src/modern/game/player.cpp
    src/modern/game/npc.cpp
    
    # Modern networking - GMCP and async
    src/modern/net/player_connection.cpp
    src/modern/net/gmcp_handler.cpp
    src/modern/net/network_manager.cpp
    
    # Modern server core
    src/modern/server/world_server.cpp
    src/modern/server/modern_mud_server.cpp
    src/modern/server/persistence_manager.cpp
    src/modern/server/configuration_manager.cpp
    
    # Modern world management
    src/modern/world/world_manager.cpp
    src/modern/world/room.cpp
    src/modern/world/zone.cpp
    
    # Modern core utilities
    src/modern/core/logging.cpp
    src/modern/core/entity.cpp
    
    # Modern command system
    src/modern/game/command_system.cpp
    src/modern/game/builtin_commands.cpp
)

# Third-party dependencies
include(FetchContent)

# fmt for formatting
FetchContent_Declare(
    fmt
    GIT_REPOSITORY https://github.com/fmtlib/fmt.git
    GIT_TAG 11.2.0
)

# nlohmann/json for JSON handling
FetchContent_Declare(
    json
    GIT_REPOSITORY https://github.com/nlohmann/json.git
    GIT_TAG v3.11.3
)

# magic_enum for enum utilities
FetchContent_Declare(
    magic_enum
    GIT_REPOSITORY https://github.com/Neargye/magic_enum.git
    GIT_TAG v0.9.7
)

# spdlog for logging
FetchContent_Declare(
    spdlog
    GIT_REPOSITORY https://github.com/gabime/spdlog.git
    GIT_TAG v1.15.3
)

# asio for networking
FetchContent_Declare(
    asio
    GIT_REPOSITORY https://github.com/chriskohlhoff/asio.git
    GIT_TAG asio-1-30-2
)

FetchContent_MakeAvailable(fmt json magic_enum spdlog asio)

# Modern FieryMUD executable
add_executable(modern_fierymud ${MODERN_SOURCES})

# Include directories for modern code only
target_include_directories(modern_fierymud PRIVATE 
    src/modern
    ${asio_SOURCE_DIR}/asio/include
)

# Link libraries
target_link_libraries(modern_fierymud PRIVATE 
    fmt::fmt 
    nlohmann_json::nlohmann_json 
    magic_enum::magic_enum 
    spdlog::spdlog
)

# Compiler definitions
target_compile_definitions(modern_fierymud PRIVATE
    ASIO_STANDALONE
    ASIO_NO_DEPRECATED
    SPDLOG_COMPILED_LIB
    SPDLOG_FMT_EXTERNAL
)

# Compiler options
target_compile_options(modern_fierymud PRIVATE
    -std=gnu++23
    -Wall
    -Wextra
    -Wno-unused-variable
    -Wno-unused-parameter
    -O3
    -DNDEBUG
    -g
)

# Installation
install(TARGETS modern_fierymud DESTINATION bin)