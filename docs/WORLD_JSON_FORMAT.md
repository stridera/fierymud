# FieryMUD World JSON Format

This document describes the JSON format used for FieryMUD world files. These files are generated by the `scripts/world_to_json.py` script and stored in `data_prod/world/` directory.

## Top-Level Structure

Each zone file (e.g., `30.json`) contains a nested structure with four main sections:

```json
{
    "zone": { ... },
    "mobs": [ ... ],
    "objects": [ ... ],
    "rooms": { "rooms": [ ... ] }
}
```

## Zone Section

The `zone` object contains zone metadata and reset commands:

```json
"zone": {
    "id": "30",                    // Zone ID (string)
    "name": "Mielikki",            // Zone display name
    "top": 3499,                   // Highest room number in zone
    "lifespan": 30,                // Minutes between resets
    "reset_mode": "Normal",        // Reset behavior: "Never", "Empty", "Normal"
    "hemisphere": "NORTHWEST",     // Weather system: NORTHWEST, NORTHEAST, SOUTHWEST, SOUTHEAST
    "climate": "OCEANIC",          // Climate type: NONE, SEMIARID, ARID, OCEANIC, TEMPERATE, SUBTROPICAL, TROPICAL, SUBARCTIC, ARCTIC, ALPINE
    "commands": {                  // Zone reset commands
        "mob": [ ... ],            // Mobile spawning commands
        "object": [ ... ],         // Object creation commands
        "remove": [ ... ],         // Object removal commands
        "door": [ ... ]            // Door state commands
    }
}
```

### Zone Commands

Zone commands control how objects and mobiles spawn during resets:

#### Mobile Commands
```json
"mob": [
    {
        "id": 600,                 // Mobile ID to spawn
        "max": 1,                  // Maximum instances
        "room": 3155,              // Room to spawn in
        "name": "(description)",   // Human-readable name
        "carrying": [              // Objects mob carries
            {
                "id": 3090,
                "max": 50,
                "name": "(object description)",
                "contains": [ ... ] // Nested objects in containers
            }
        ],
        "equipped": [              // Objects mob wears/wields
            {
                "id": 3001,
                "max": 1,
                "location": 17,    // Equipment slot
                "name": "(object description)"
            }
        ]
    }
]
```

#### Object Commands
```json
"object": [
    {
        "id": 3000,                // Object ID to create
        "max": 1,                  // Maximum instances
        "room": 3001,              // Room to place in
        "name": "(description)",   // Human-readable name
        "create_objects": [        // Objects to place inside
            {
                "id": 3001,
                "max": 1,
                "container": 3000, // Parent object ID
                "name": "(description)"
            }
        ]
    }
]
```

## Mobs Section

The `mobs` array contains mobile (NPC) definitions:

```json
"mobs": [
    {
        "id": 3000,                           // Unique mobile ID
        "name_list": "bigby wizard shopkeeper", // Keywords for targeting
        "mob_class": "Sorcerer",              // Character class
        "short_description": "Bigby",         // Name shown in room
        "long_description": "Bigby walks around...", // Description when in room
        "description": "Bigby looks to be very old...", // Examine description
        "mob_flags": "SENTINEL, ISNPC, AWARE, MEMORY, NOCHARM, NOSUMMON, NOSLEEP, NOBASH, PEACEFUL, NO_CLASS_AI",
        "effect_flags": "DETECT_INVIS",       // Magical effects
        "alignment": 900,                     // Good/evil alignment (-1000 to 1000)
        "level": 99,                         // Character level
        "hp_dice": {                         // Hit point calculation
            "num": 0,                        // Number of dice
            "size": 0,                       // Die size
            "bonus": 0                       // Fixed bonus
        },
        "move": 0,                           // Movement points
        "ac": 0,                             // Armor class
        "hit_roll": 0,                       // Attack bonus
        "damage_dice": {                     // Damage calculation
            "num": 0,
            "size": 0,
            "bonus": 0
        },
        "money": {                           // Starting money
            "copper": "0",
            "silver": "0",
            "gold": "0",
            "platinum": "0"
        },
        "position": "STANDING",              // Default position
        "default_position": "STANDING",      // Position when reset
        "gender": "NEUTRAL",                 // Gender
        "mob_class": "Sorcerer",            // Character class (enum)
        "race": "HUMAN",                    // Race
        "race_align": 0,                    // Racial alignment modifier
        "size": "MEDIUM",                   // Size category
        "stats": {                          // Ability scores
            "strength": 18,
            "intelligence": 25,
            "wisdom": 20,
            "dexterity": 15,
            "constitution": 18,
            "charisma": 16
        },
        "perception": 50,                   // Perception skill
        "concealment": 0,                   // Stealth skill
        "life_force": "LIFE",              // Life force type
        "composition": "FLESH",             // Body composition
        "stance": "ALERT",                  // Combat stance
        "damage_type": "HIT"                // Unarmed attack type
    }
]
```

## Objects Section

The `objects` array contains item definitions:

```json
"objects": [
    {
        "id": "3000",                        // Unique object ID (string)
        "type": "DRINKCON",                  // Object type (see ObjectType enum)
        "name_list": "beer barrel beer-barrel", // Keywords for targeting
        "short_description": "a barrel",     // Name shown in inventory
        "description": "A beer barrel has been left here.", // Description when on ground
        "action_description": "",            // Special action text
        "extra_descriptions": [              // Additional examine descriptions
            {
                "keyword": "beer barrel",
                "desc": "The barrel looks like it could hold large amounts of beer..."
            }
        ],
        "values": {                          // Type-specific properties
            "Capacity": "512",               // For containers/drink containers
            "Remaining": "512",              // Current contents
            "Liquid": "BEER",                // Liquid type
            "Poisoned": "0"                  // Poison flag
        },
        "flags": [                           // Object flags
            "FLOAT"
        ],
        "weight": "8.00",                   // Weight in pounds
        "cost": "300",                      // Base cost in copper
        "timer": "0",                       // Decay timer
        "decompose_timer": "0",             // Decomposition timer
        "level": "1",                       // Minimum level to use
        "effect_flags": [],                 // Magical effects when worn
        "wear_flags": [],                   // Where item can be worn
        "concealment": 0,                   // Stealth modifier
        "affects": [],                      // Stat modifications
        "applies": {},                      // Ability score modifiers
        "spells": [],                       // For spellbooks
        "triggers": [],                     // Script triggers
        "script_variables": {},             // Script data
        "effects": []                       // Special object effects
    }
]
```

### Object Types

Common object types include:
- `LIGHT` - Light sources
- `WEAPON` - Weapons
- `ARMOR` - Armor and shields
- `CONTAINER` - Bags, chests, boxes
- `DRINKCON` - Drink containers
- `FOOD` - Food items
- `POTION` - Potions and elixirs
- `KEY` - Keys for locked doors/containers
- `TREASURE` - Valuable items
- `NOTE` - Readable items
- `PORTAL` - Teleportation items

## Rooms Section

The `rooms` object contains a nested `rooms` array with room definitions:

```json
"rooms": [
    {
        "id": "3001",                    // Unique room ID (string)
        "name": "The Forest Temple of Mielikki", // Room title
        "description": "You are standing in the ancient wooded grove...", // Room description
        "sector": "STRUCTURE",           // Terrain type (affects movement)
        "flags": "NOMOB, INDOORS, PEACEFUL, BFS_MARK, ALWAYSLIT", // Room flags
        "exits": {                       // Available exits
            "North": {
                "description": "You see the altar of the Goddess Mielikki to the north.",
                "keyword": "",           // Keywords needed to use exit
                "key": "-1",             // Key required (-1 = no key)
                "destination": "3002"    // Target room ID
            },
            "South": {
                "description": "The hustle and bustle of the Town Center lies to the south.",
                "keyword": "",
                "key": "-1",
                "destination": "3005"
            }
        },
        "extra_descriptions": {          // Additional examine targets
            "altar": "The altar is made of living wood...",
            "canopy trees": "The ancient trees form a natural cathedral..."
        }
    }
]
```

### Room Flags

Common room flags:
- `DARK` - Room is dark without light
- `DEATH` - Room kills players who enter
- `NOMOB` - Mobiles won't enter
- `INDOORS` - Room is inside (affects weather)
- `PEACEFUL` - No combat allowed
- `SOUNDPROOF` - Says/shouts don't carry
- `NOTRACK` - Can't be tracked to
- `NOMAGIC` - Magic doesn't work
- `TUNNEL` - Only 1 person can enter
- `PRIVATE` - Maximum 2 people
- `GODROOM` - Only gods can enter
- `HOUSE` - Player house
- `HOUSECRASH` - House saves inventory
- `ATRIUM` - House entrance
- `OLC` - Online creation allowed
- `BFS_MARK` - Breadth-first search marker

## Field Mappings

Key differences between legacy and modern field names:

| JSON Field | Modern Field | Notes |
|------------|--------------|-------|
| `name_list` | `name` | Keywords for targeting |
| `short_description` | `short_desc` | Brief description |
| `long_description` | `long_desc` | Room presence description |
| `action_description` | `action_desc` | Special action text |
| `extra_descriptions` | `extra_descs` | Array vs object structure |
| `mob_flags` | `flags` | Comma-separated string |
| `effect_flags` | `effects` | Magical effects |

## ID Handling

- Zone IDs are strings in JSON but converted to integers
- Zone 0 is converted to ID 1000 (modern system rejects ID 0)
- Room and object IDs are strings in JSON
- Mobile IDs are integers in JSON

## Usage in Code

The modern FieryMUD system loads these files via:
1. `WorldManager::load_world()` reads zone files from `data_prod/world/`
2. `Zone::from_json()` parses the zone section
3. Entity `from_json()` methods handle mobs, objects, and rooms
4. Field mapping handles differences between JSON and internal representation