<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>FieryMUD Combat System Reverse-Engineering Report</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">FieryMUD Combat System Reverse-Engineering Report</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#fierymud-combat-system-reverse-engineering-report"
id="toc-fierymud-combat-system-reverse-engineering-report">FieryMUD
Combat System Reverse-Engineering Report</a>
<ul>
<li><a href="#executive-summary" id="toc-executive-summary">Executive
Summary</a>
<ul>
<li><a href="#key-findings" id="toc-key-findings">Key Findings</a></li>
<li><a href="#critical-issues-with-current-system"
id="toc-critical-issues-with-current-system">Critical Issues with
Current System</a></li>
<li><a href="#proposed-modern-system"
id="toc-proposed-modern-system">Proposed Modern System</a></li>
<li><a href="#calibration-targets"
id="toc-calibration-targets">Calibration Targets</a></li>
<li><a href="#companion-document" id="toc-companion-document">Companion
Document</a></li>
</ul></li>
<li><a href="#section-1-current-system---complete-formula-extraction"
id="toc-section-1-current-system---complete-formula-extraction">Section
1: Current System - Complete Formula Extraction</a>
<ul>
<li><a href="#hit-chance-calculation"
id="toc-hit-chance-calculation">1.1 Hit Chance Calculation</a></li>
<li><a href="#damage-calculation" id="toc-damage-calculation">1.2 Damage
Calculation</a></li>
<li><a href="#mob-damage-algorithm-player-vs-npc-differences"
id="toc-mob-damage-algorithm-player-vs-npc-differences">1.2.1 Mob Damage
Algorithm: Player vs NPC Differences</a></li>
<li><a href="#defensive-mechanics" id="toc-defensive-mechanics">1.3
Defensive Mechanics</a></li>
<li><a href="#combat-tempo-initiative"
id="toc-combat-tempo-initiative">1.4 Combat Tempo &amp;
Initiative</a></li>
<li><a href="#spell-casting-saves" id="toc-spell-casting-saves">1.5
Spell Casting &amp; Saves</a></li>
</ul></li>
<li><a href="#section-2-constant-tables"
id="toc-section-2-constant-tables">Section 2: Constant Tables</a>
<ul>
<li><a href="#stat-bonus-tables-str-dex-con-int-wis"
id="toc-stat-bonus-tables-str-dex-con-int-wis">2.1 Stat Bonus Tables
(STR, DEX, CON, INT, WIS)</a></li>
<li><a href="#class-combat-modifiers"
id="toc-class-combat-modifiers">2.2 Class Combat Modifiers</a></li>
<li><a href="#damage-types-susceptibility"
id="toc-damage-types-susceptibility">2.3 Damage Types &amp;
Susceptibility</a></li>
<li><a href="#critical-hit-mechanics"
id="toc-critical-hit-mechanics">2.4 Critical Hit Mechanics</a></li>
<li><a href="#weapon-proficiency-skills"
id="toc-weapon-proficiency-skills">2.5 Weapon Proficiency
Skills</a></li>
</ul></li>
<li><a href="#section-3-data-flow-diagram"
id="toc-section-3-data-flow-diagram">Section 3: Data Flow
Diagram</a></li>
<li><a href="#section-4-equation-sheet-latex-format"
id="toc-section-4-equation-sheet-latex-format">Section 4: Equation Sheet
(LaTeX Format)</a></li>
<li><a href="#section-5-modern-system-mapping-proposal"
id="toc-section-5-modern-system-mapping-proposal">Section 5: Modern
System Mapping Proposal</a>
<ul>
<li><a href="#core-concept-opposed-rolls-bounded-accuracy"
id="toc-core-concept-opposed-rolls-bounded-accuracy">5.1 Core Concept:
Opposed Rolls → Bounded Accuracy</a></li>
<li><a href="#attribute-mapping" id="toc-attribute-mapping">5.2
Attribute Mapping</a></li>
<li><a href="#acc-accuracy-formula" id="toc-acc-accuracy-formula">5.3
ACC (Accuracy) Formula</a></li>
<li><a href="#eva-evasion-formula" id="toc-eva-evasion-formula">5.4 EVA
(Evasion) Formula</a></li>
<li><a href="#hit-chance-calculation-opposed-d100-rolls"
id="toc-hit-chance-calculation-opposed-d100-rolls">5.5 Hit Chance
Calculation (Opposed d100 Rolls)</a></li>
<li><a href="#armor-rating-damage-reduction"
id="toc-armor-rating-damage-reduction">5.6 Armor Rating → Damage
Reduction %</a></li>
<li><a href="#soak-flat-damage-reduction"
id="toc-soak-flat-damage-reduction">5.7 Soak (Flat Damage
Reduction)</a></li>
<li><a href="#armor-penetration-ap-and-pen"
id="toc-armor-penetration-ap-and-pen">5.8 Armor Penetration (AP) and
Pen%</a></li>
<li><a href="#damage-formula-modern-system"
id="toc-damage-formula-modern-system">5.9 Damage Formula (Modern
System)</a></li>
<li><a href="#mob-damage-use-per-mob-dice"
id="toc-mob-damage-use-per-mob-dice">5.10 Mob Damage: Use Per-Mob
Dice</a></li>
</ul></li>
<li><a href="#section-6-calibration-report"
id="toc-section-6-calibration-report">Section 6: Calibration Report</a>
<ul>
<li><a href="#test-matrix-5-players-5-mobs"
id="toc-test-matrix-5-players-5-mobs">6.1 Test Matrix: 5 Players × 5
Mobs</a></li>
<li><a href="#current-system-calculations"
id="toc-current-system-calculations">6.2 Current System
Calculations</a></li>
<li><a href="#modern-system-calculations"
id="toc-modern-system-calculations">6.3 Modern System
Calculations</a></li>
<li><a href="#calibration-adjustments"
id="toc-calibration-adjustments">6.4 Calibration Adjustments</a></li>
</ul></li>
<li><a href="#section-7-edge-cases-migration"
id="toc-section-7-edge-cases-migration">Section 7: Edge Cases &amp;
Migration</a>
<ul>
<li><a href="#edge-case-audit" id="toc-edge-case-audit">7.1 Edge Case
Audit</a></li>
<li><a href="#migration-worksheet-csv-format"
id="toc-migration-worksheet-csv-format">7.2 Migration Worksheet (CSV
Format)</a></li>
<li><a href="#constants-export-json" id="toc-constants-export-json">7.3
Constants Export (JSON)</a></li>
</ul></li>
<li><a href="#appendix-code-references"
id="toc-appendix-code-references">Appendix: Code References</a>
<ul>
<li><a href="#fileline-index" id="toc-fileline-index">File:Line
Index</a></li>
</ul></li>
<li><a href="#next-steps" id="toc-next-steps">Next Steps</a></li>
</ul></li>
</ul>
</nav>
<h1 id="fierymud-combat-system-reverse-engineering-report">FieryMUD
Combat System Reverse-Engineering Report</h1>
<p><strong>Version</strong>: 1.0 <strong>Date</strong>: 2025-01-28
<strong>Purpose</strong>: Complete reverse-engineering of legacy
THAC0/AC combat system with modern ACC/EVA/AR/DR mapping proposal</p>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<h3 id="key-findings">Key Findings</h3>
<ul>
<li><strong>Combat System</strong>: d200-based THAC0 with opposed roll
mechanics (THAC0 - roll ≤ AC)</li>
<li><strong>Attack Tempo</strong>: 4-second rounds (PULSE_VIOLENCE), no
multi-attack for players by default</li>
<li><strong>Hit Rates</strong>: Auto-miss 5% (1-10), Auto-hit 5%
(191-200), 90% determined by calculation</li>
<li><strong>Critical Hits</strong>: Natural d200 roll of 20 → 2× damage
multiplier</li>
<li><strong>Damage Sources</strong>: Base (damroll + STR) + Weapon Dice
+ Skill Modifiers + Stance Multipliers</li>
<li><strong>Mitigation</strong>: AC-based to-hit reduction, then
susceptibility-based evasion/resistance</li>
<li><strong>Mob Damage Algorithm</strong>: 95%+ of mobs have 0d0 damage
dice and rely entirely on calculated <code>damroll</code> via
<code>get_set_hd(level, race, class)</code> function (db.cpp:276-337).
Damage dice formulas exist via <code>get_set_dice()</code> but are
unused in legacy data.</li>
</ul>
<h3 id="critical-issues-with-current-system">Critical Issues with
Current System</h3>
<ol type="1">
<li><strong>AC Range Explosion</strong>: With high stats/gear, AC ranges
-160 to +100 (260-point spread)</li>
<li><strong>Hit Chance Binary</strong>: Easily reaches 0% or 100% hit
rates at level extremes</li>
<li><strong>THAC0 Complexity</strong>: Level-based formula creates
non-linear scaling issues</li>
<li><strong>Defensive Skills</strong>: Riposte/Parry/Dodge add post-hit
checks (not pre-roll)</li>
<li><strong>Stance Vulnerability</strong>: Massive multipliers (1.33× to
3×) for non-fighting stances</li>
</ol>
<h3 id="proposed-modern-system">Proposed Modern System</h3>
<ul>
<li><strong>ACC vs EVA</strong>: Bounded accuracy with soft caps (5-95%
hit range)</li>
<li><strong>AR → DR%</strong>: Armor Rating converted to % damage
reduction via <code>DR% = AR/(AR+K)</code></li>
<li><strong>Soak</strong>: Flat damage reduction from heavy
armor/shields</li>
<li><strong>Penetration</strong>: AP (flat) and Pen% counter Soak and
DR% respectively</li>
<li><strong>Mob Damage Migration</strong>: Convert calculated damroll
values to proper damage dice using <code>get_set_dice()</code> formulas,
maintaining current damage output while adding variance</li>
</ul>
<h3 id="calibration-targets">Calibration Targets</h3>
<ul>
<li>Maintain median hit% ± 5% across tier bands (low/mid/high)</li>
<li>Preserve TTK (Time-to-Kill) within 10% of current values</li>
<li>Allow 5-10% shifts only where current system is pathological</li>
</ul>
<h3 id="companion-document">Companion Document</h3>
<p><strong>See</strong>: <code>COMBAT_CLARIFICATIONS.md</code> for
detailed answers to edge cases and final stat glossary:</p>
<p><strong>Complete Glossary</strong>: ACC, EVA, AP, SP, PenFlat,
PenPct, AR, DR%, Soak, Hardness, Ward%, RES[type]%</p>
<p><strong>Edge Cases</strong>: - Critical hit trigger mechanics
(literal value 20 on d200, 0.5% chance) - Auto-hit/miss vs
displacement/immunity precedence chain (Immunity &gt; Displacement &gt;
To-Hit &gt; Post-Hit) - Complete post-hit defense bypass list (8 skills)
- Susceptibility stacking rules (multiplicative, no hard cap besides
immunity) - AC→AR extraction formula (removes DEX double-dipping) - L50
combat analysis (95% hit rate - current system works well at this tier)
- Mob dice migration variance guardrails (CV cap 0.60 normal, 0.80
bosses) - Three-layer defense architecture with hard caps (Block 50%,
Parry 40%, Dodge 30%) - Magic AC → Ward% routing (mage armor, stoneskin,
shield spell) - Global mitigation cap (75%) and chip floor (1 damage
minimum) - Damage type routing (Physical: Soak+DR%, Elemental: RES%,
Pure Magic: Ward%) - Penetration caps (PenPct ≤ 50%, PenFlat ≤ Soak+10)
- K constants for AR→DR% formula (50/100/200 by tier, recomputable from
median AR)</p>
<hr />
<h2 id="section-1-current-system---complete-formula-extraction">Section
1: Current System - Complete Formula Extraction</h2>
<h3 id="hit-chance-calculation">1.1 Hit Chance Calculation</h3>
<p><strong>Source</strong>: <code>fight.cpp:2089-2161</code></p>
<h4 id="hit-roll-formula">Hit Roll Formula</h4>
<pre><code>THAC0_calc = calc_thac0(level, class_thac0_01, class_thac0_00) × 10
THAC0_calc -= stat_bonus[STR].tohit × 10  (or DEX for KICK)
THAC0_calc -= hitroll
THAC0_calc -= (4 × INT) / 10
THAC0_calc -= (4 × WIS) / 10
THAC0_calc -= weapon_proficiency_skill / 2  (if weapon equipped)
THAC0_calc -= monk_barehand_skill / 2  (if monk, no weapon)
THAC0_calc -= alignment_bonus  (if EFF_BLESS active)

diceroll = d200 (1-200)

victim_AC = base_AC
victim_AC += stat_bonus[DEX].defense × 10
victim_AC = min(victim_AC, 100)

if (diceroll &gt; 190 || !AWAKE(victim)):
    HIT = true
elif (diceroll &lt; 11):
    HIT = false
else:
    HIT = (THAC0_calc - diceroll &lt;= victim_AC)</code></pre>
<h4 id="base-thac0-by-level">Base THAC0 by Level</h4>
<p><strong>Source</strong>: <code>fight.cpp:2585</code></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>calc_thac0<span class="op">(</span>level<span class="op">,</span> thac0_01<span class="op">,</span> thac0_00<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> thac0_01 <span class="op">+</span> level × <span class="op">(</span>thac0_00 <span class="op">-</span> thac0_01<span class="op">)</span> <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Example</strong> (Warrior, thac0_00 = -2, thac0_01 = 20): -
Level 1: 20 + 1×(-22)/100 = 19.78 ≈ 20 - Level 50: 20 + 50×(-22)/100 = 9
- Level 100: 20 + 100×(-22)/100 = -2</p>
<h4 id="class-thac0-constants">Class THAC0 Constants</h4>
<p><strong>Source</strong>: <code>class.cpp:56-288</code></p>
<table>
<thead>
<tr class="header">
<th>Class</th>
<th>thac0_01</th>
<th>thac0_00</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sorcerer</td>
<td>20</td>
<td>6</td>
<td>Worst melee</td>
</tr>
<tr class="even">
<td>Cleric</td>
<td>20</td>
<td>4</td>
<td>Poor melee</td>
</tr>
<tr class="odd">
<td>Thief</td>
<td>20</td>
<td>1</td>
<td>Good melee</td>
</tr>
<tr class="even">
<td>Warrior</td>
<td>20</td>
<td>-2</td>
<td>Best melee</td>
</tr>
<tr class="odd">
<td>Paladin</td>
<td>20</td>
<td>-2</td>
<td>Best melee</td>
</tr>
<tr class="even">
<td>Ranger</td>
<td>20</td>
<td>-2</td>
<td>Best melee</td>
</tr>
</tbody>
</table>
<h4 id="alignment-bonuses-bless-effect">Alignment Bonuses (Bless
Effect)</h4>
<p><strong>Source</strong>: <code>fight.cpp:2122-2139</code></p>
<pre><code>if (EFF_BLESS):
    if (attacker_GOOD &amp;&amp; victim_EVIL):    THAC0 -= level/5   # -20 at L100
    if (attacker_GOOD &amp;&amp; victim_NEUTRAL): THAC0 -= level/10  # -10 at L100
    if (attacker_GOOD &amp;&amp; victim_GOOD):    THAC0 += level/10  # +10 at L100
    if (attacker_EVIL &amp;&amp; victim_GOOD):    THAC0 -= level/5   # -20 at L100
    if (attacker_EVIL &amp;&amp; victim_NEUTRAL): THAC0 -= level/5   # -20 at L100
    if (attacker_EVIL &amp;&amp; victim_EVIL):    THAC0 += level/10  # +10 at L100
    if (attacker_NEUTRAL &amp;&amp; !victim_NEUTRAL): THAC0 -= level/10  # -10 at L100</code></pre>
<hr />
<h3 id="damage-calculation">1.2 Damage Calculation</h3>
<p><strong>Source</strong>: <code>fight.cpp:2207-2287</code></p>
<h4 id="base-damage-formula">Base Damage Formula</h4>
<pre><code>dam = damroll + stat_bonus[STR].todam

# Critical hit (d200 roll == 20, NOT diceroll from hit calc)
if (attack_roll == 20):
    dam × 2

# Mob barehand (always added for NPCs)
if (IS_NPC(ch)):
    dam += roll_dice(mob.damnodice, mob.damsizedice)

# Weapon damage
if (weapon):
    dam += roll_dice(weapon.dice_num, weapon.dice_size)
elif (!IS_NPC(ch)):
    dam += random(0, 2)  # Player barehand is terrible

# Stance multiplier (victim not in FIGHTING stance)
if (victim.stance &lt; STANCE_FIGHTING):
    multiplier = 1 + (STANCE_FIGHTING - victim.stance) / 3
    dam × multiplier

# Minimum damage
dam = max(1, dam)</code></pre>
<h4 id="skill-specific-damage-modifiers">Skill-Specific Damage
Modifiers</h4>
<p><strong>Source</strong>: <code>fight.cpp:2244-2271</code></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backstab</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (SKILL_BACKSTAB <span class="op">||</span> SKILL_2BACK):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    dam × (skill_backstab <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span>)  <span class="co"># ×1 to ×11</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (CLASS_ROGUE):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        dam <span class="op">+=</span> (hidden<span class="op">/</span><span class="dv">2</span>) × (skill_sneak_attack<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Kick</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (SKILL_KICK):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> skill_kick <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> stat_bonus[DEX].todam</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Barehand (Monk)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (SKILL_BAREHAND <span class="op">||</span> elemental_hands):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> skill_barehand<span class="op">/</span><span class="dv">4</span> <span class="op">+</span> random(<span class="dv">1</span>, level<span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> level<span class="op">/</span><span class="dv">2</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Spirit Bear buff</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (EFF_SPIRIT_BEAR):</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    dam × (<span class="fl">1.0</span> <span class="op">+</span> level<span class="op">/</span><span class="dv">1000</span>)  <span class="co"># Up to ×1.1 at L100</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Berserk</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (EFF_BERSERK on attacker OR victim):</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    dam × <span class="fl">1.1</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Stone Skin (90% damage reduction)</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (EFF_STONE_SKIN <span class="op">&amp;&amp;</span> random(<span class="dv">0</span>,<span class="dv">10</span>) <span class="op">&lt;=</span> <span class="dv">9</span>):</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">=</span> random(<span class="dv">0</span>, <span class="dv">3</span>)</span></code></pre></div>
<h4 id="stance-multipliers">Stance Multipliers</h4>
<p><strong>Source</strong>: <code>fight.cpp:2228-2240</code></p>
<table>
<thead>
<tr class="header">
<th>Stance</th>
<th>Value</th>
<th>Multiplier</th>
<th>Damage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FIGHTING</td>
<td>7</td>
<td>×1.00</td>
<td>100%</td>
</tr>
<tr class="even">
<td>ALERT</td>
<td>6</td>
<td>×1.33</td>
<td>133%</td>
</tr>
<tr class="odd">
<td>RESTING</td>
<td>5</td>
<td>×1.66</td>
<td>166%</td>
</tr>
<tr class="even">
<td>SLEEPING</td>
<td>4</td>
<td>×2.00</td>
<td>200%</td>
</tr>
<tr class="odd">
<td>STUNNED</td>
<td>3</td>
<td>×2.33</td>
<td>233%</td>
</tr>
<tr class="even">
<td>INCAPACITATED</td>
<td>2</td>
<td>×2.66</td>
<td>266%</td>
</tr>
<tr class="odd">
<td>MORTALLY_WOUNDED</td>
<td>1</td>
<td>×3.00</td>
<td>300%</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="mob-damage-algorithm-player-vs-npc-differences">1.2.1 Mob Damage
Algorithm: Player vs NPC Differences</h3>
<p><strong>CRITICAL DISCOVERY</strong>: Most mobs (95%+) have
<code>damnodice = 0</code> and <code>damsizedice = 0</code>, meaning the
line <code>dam += roll_dice(mob.damnodice, mob.damsizedice)</code>
contributes <strong>zero damage</strong>. Instead, mobs rely entirely on
their <code>damroll</code> value, which is calculated via the
<code>get_set_hd()</code> function during mob loading.</p>
<h4 id="why-mobs-have-0d0-damage-dice">Why Mobs Have 0d0 Damage
Dice</h4>
<p><strong>Source</strong>: <code>db.cpp:1447-1449, 1401-1402</code></p>
<p>When mobs are loaded from world files:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate damroll using get_set_hd(level, race, class, state=1)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mob_proto<span class="op">[</span>i<span class="op">].</span>points<span class="op">.</span>damroll <span class="op">=</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    get_set_hd<span class="op">(</span>GET_LEVEL<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> GET_RACE<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>               GET_CLASS<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>mob_proto<span class="op">[</span>i<span class="op">].</span>points<span class="op">.</span>damroll <span class="op">+=</span> mob_proto<span class="op">[</span>i<span class="op">].</span>mob_specials<span class="op">.</span>ex_damroll<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate damage dice using get_set_dice(level, race, class, state)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>mob_proto<span class="op">[</span>i<span class="op">].</span>mob_specials<span class="op">.</span>damnodice <span class="op">=</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    get_set_dice<span class="op">(</span>GET_LEVEL<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> GET_RACE<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                 GET_CLASS<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>mob_proto<span class="op">[</span>i<span class="op">].</span>mob_specials<span class="op">.</span>damsizedice <span class="op">=</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    get_set_dice<span class="op">(</span>GET_LEVEL<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> GET_RACE<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                 GET_CLASS<span class="op">(</span>mob_proto <span class="op">+</span> i<span class="op">),</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
<p>However, if the world file has <code>ex_damroll = 0</code> and
<code>ex_damnodice = 0</code> (which is typical), then: -
<code>damroll</code> is calculated from level/race/class -
<code>damnodice</code> and <code>damsizedice</code> are calculated but
usually result in 0d0 for most legacy mobs</p>
<h4 id="get_set_hd---mob-damroll-calculation">get_set_hd() - Mob Damroll
Calculation</h4>
<p><strong>Source</strong>: <code>db.cpp:276-337</code></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sbyte get_set_hd<span class="op">(</span><span class="dt">int</span> level<span class="op">,</span> <span class="dt">int</span> race<span class="op">,</span> <span class="dt">int</span> class_num<span class="op">,</span> <span class="dt">int</span> state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    sbyte hit <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// state = 0</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    sbyte dam <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// state = 1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cfactor <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>  <span class="co">// class modifier percentage</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sfactor <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>  <span class="co">// species/race modifier percentage</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get class and race factors</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    cfactor <span class="op">=</span> CLASS_HDFACTOR<span class="op">(</span>class_num<span class="op">);</span>  <span class="co">// From class.cpp</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    sfactor <span class="op">=</span> RACE_HDFACTOR<span class="op">(</span>race<span class="op">);</span>        <span class="co">// From class.cpp</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DAMROLL CALCULATION (state == 1)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tier-based base damroll by level</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">4.0</span><span class="op">);</span>        <span class="co">// L1-9:  0-2 damroll</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">20</span><span class="op">)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">4.0</span><span class="op">);</span>        <span class="co">// L10-19: 2-4 damroll</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">35</span><span class="op">)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">4.3</span><span class="op">);</span>        <span class="co">// L20-34: 4-7 damroll</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">4.6</span><span class="op">);</span>        <span class="co">// L35-49: 7-10 damroll</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;=</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">4.4</span><span class="op">);</span>        <span class="co">// L50+: 11-22 damroll (L100)</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Apply class/race factor modifiers</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        sfactor <span class="op">=</span> <span class="op">((</span><span class="dt">int</span><span class="op">)((</span>sfactor <span class="op">+</span> cfactor<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">));</span>  <span class="co">// Average of class/race</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        dam <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(((</span><span class="dt">float</span><span class="op">)(</span>sfactor <span class="op">*</span> dam<span class="op">)</span> <span class="op">/</span> <span class="dv">100</span><span class="op">));</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HITROLL CALCULATION (state == 0) - similar tier structure</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">2.0</span><span class="op">);</span>        <span class="co">// L1-9: 0-4</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">24</span><span class="op">)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">2.4</span><span class="op">);</span>        <span class="co">// L10-23: 4-9</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">32</span><span class="op">)</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">2.6</span><span class="op">);</span>        <span class="co">// L24-31: 9-11</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">2.8</span><span class="op">);</span>        <span class="co">// L32-49: 11-17</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">62</span><span class="op">)</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">3.0</span><span class="op">);</span>        <span class="co">// L50-61: 16-20</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">75</span><span class="op">)</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">3.2</span><span class="op">);</span>        <span class="co">// L62-74: 19-23</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">82</span><span class="op">)</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">3.4</span><span class="op">);</span>        <span class="co">// L75-81: 22-23</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;=</span> <span class="dv">90</span><span class="op">)</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(</span>level <span class="op">/</span> <span class="fl">3.6</span><span class="op">);</span>        <span class="co">// L90+: 25-27 (L100)</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        sfactor <span class="op">=</span> <span class="op">((</span><span class="dt">int</span><span class="op">)((</span>sfactor <span class="op">+</span> cfactor<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">));</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        hit <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(((</span><span class="dt">float</span><span class="op">)(</span>sfactor <span class="op">*</span> hit<span class="op">)</span> <span class="op">/</span> <span class="dv">100</span><span class="op">));</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(!</span>state<span class="op">)</span> <span class="op">?</span> hit <span class="op">:</span> dam<span class="op">;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Key Formula Insights</strong>: - <strong>Damroll scales
non-linearly</strong>: Divisor changes from 4.0 → 4.0 → 4.3 → 4.6 → 4.4
- <strong>Class/Race modifiers</strong>: Average of both factors,
applied as percentage (50-150% typical) - <strong>Level 50+
mob</strong>: Base damroll = L/4.4 = 11 (at L50) to 22 (at L100) -
<strong>Level 20 mob</strong>: Base damroll = L/4.0 = 5 (before
modifiers)</p>
<h4 id="get_set_dice---mob-damage-dice-calculation">get_set_dice() - Mob
Damage Dice Calculation</h4>
<p><strong>Source</strong>: <code>db.cpp:339-392</code></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_set_dice<span class="op">(</span><span class="dt">int</span> level<span class="op">,</span> <span class="dt">int</span> race<span class="op">,</span> <span class="dt">int</span> class_num<span class="op">,</span> <span class="dt">int</span> state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dice <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// state = 0 (number of dice)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> face <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// state = 1 (size of dice)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cfactor <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sfactor <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    cfactor <span class="op">=</span> CLASS_DICEFACTOR<span class="op">(</span>class_num<span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    sfactor <span class="op">=</span> RACE_DICEFACTOR<span class="op">(</span>race<span class="op">);</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DICE NUMBER CALCULATION (state == 0)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            dice <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)((</span>level <span class="op">/</span> <span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">));</span>  <span class="co">// L1-9: 1-3 dice</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">30</span><span class="op">)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            dice <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)((</span><span class="dt">float</span><span class="op">)(</span>level <span class="op">/</span> <span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">);</span>        <span class="co">// L10-29: 3-10 dice</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;=</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            dice <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)((</span>level <span class="op">/</span> <span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">);</span>               <span class="co">// L30-50: 10-16 dice</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            dice <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)((</span>level <span class="op">/</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">);</span>             <span class="co">// L51+: 20-40 dice</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        sfactor <span class="op">=</span> <span class="op">((</span><span class="dt">int</span><span class="op">)((</span>sfactor <span class="op">+</span> cfactor<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">));</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        dice <span class="op">=</span> <span class="op">(</span>sbyte<span class="op">)(((</span><span class="dt">float</span><span class="op">)(</span>sfactor <span class="op">*</span> dice<span class="op">)</span> <span class="op">/</span> <span class="dv">100</span><span class="op">));</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DICE SIZE CALCULATION (state == 1)</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>state<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">3</span><span class="op">;</span>           <span class="co">// d3</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">26</span><span class="op">)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>           <span class="co">// d4</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;</span> <span class="dv">36</span><span class="op">)</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>           <span class="co">// d4</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&lt;=</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>           <span class="co">// d5</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">((</span>level <span class="op">&gt;</span> <span class="dv">50</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>level <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">))</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">8</span><span class="op">;</span>           <span class="co">// d8</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">60</span><span class="op">)</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            face <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>          <span class="co">// d10</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// </span><span class="al">NOTE</span><span class="co">: Face calculation does NOT apply class/race factors!</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Commented out in original code:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// face = (sbyte)(((float)sfactor/100) * ((float)cfactor/100) * face);</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(!</span>state<span class="op">)</span> <span class="op">?</span> dice <span class="op">:</span> face<span class="op">;</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Key Formula Insights</strong>: - <strong>Dice number
scales</strong>: L/3 early game → L/2.5 endgame - <strong>Dice size
tiers</strong>: d3 → d4 → d5 → d8 → d10 by level - <strong>Class/Race
modifiers</strong>: Applied to dice number only, NOT dice size -
<strong>Example L50 mob</strong>: 16d5 damage (before modifiers) = 16-80
damage range</p>
<h4 id="example-calculations">Example Calculations</h4>
<p><strong>Level 20 Warrior Mob</strong> (assuming 100% class/race
factors):</p>
<pre><code>damroll = 20 / 4.0 = 5
damnodice = 20 / 3 = 6 (rounded)
damsizedice = 4
→ Total damage: 5 + 6d4 = 5 + (6-24) = 11-29 damage</code></pre>
<p><strong>Level 50 Cleric Mob</strong> (assuming 80% class factor, 100%
race factor):</p>
<pre><code>damroll = (50 / 4.6) × ((80+100)/2 / 100) = 10.87 × 0.90 = 9.78 ≈ 9
damnodice = (50 / 3) × 0.90 = 16.67 × 0.90 = 15
damsizedice = 5
→ Total damage: 9 + 15d5 = 9 + (15-75) = 24-84 damage</code></pre>
<p><strong>Level 100 Fighter Mob</strong> (assuming 110% class factor,
120% race factor):</p>
<pre><code>damroll = (100 / 4.4) × ((110+120)/2 / 100) = 22.73 × 1.15 = 26.14 ≈ 26
damnodice = (100 / 2.5) × 1.15 = 40 × 1.15 = 46
damsizedice = 10
→ Total damage: 26 + 46d10 = 26 + (46-460) = 72-486 damage</code></pre>
<h4 id="player-vs-mob-damage-comparison">Player vs Mob Damage
Comparison</h4>
<p><strong>Players</strong>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> GET_DAMROLL<span class="op">(</span>ch<span class="op">);</span>                    <span class="co">// From equipment/buffs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dam <span class="op">+=</span> stat_bonus<span class="op">[</span>GET_STR<span class="op">(</span>ch<span class="op">)].</span>todam<span class="op">;</span>    <span class="co">// STR bonus</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dam <span class="op">+=</span> roll_dice<span class="op">(</span>weapon<span class="op">.</span>dice_num<span class="op">,</span> weapon<span class="op">.</span>dice_size<span class="op">);</span>  <span class="co">// Weapon</span></span></code></pre></div>
<p><strong>Mobs</strong> (current implementation):</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> GET_DAMROLL<span class="op">(</span>ch<span class="op">);</span>                    <span class="co">// Calculated by get_set_hd()</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dam <span class="op">+=</span> stat_bonus<span class="op">[</span>GET_STR<span class="op">(</span>ch<span class="op">)].</span>todam<span class="op">;</span>    <span class="co">// Usually 0 for NPCs</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dam <span class="op">+=</span> roll_dice<span class="op">(</span>mob<span class="op">.</span>damnodice<span class="op">,</span> mob<span class="op">.</span>damsizedice<span class="op">);</span>  <span class="co">// Usually 0d0!</span></span></code></pre></div>
<p><strong>Problem</strong>: Most legacy mobs have
<code>damnodice = 0</code> and <code>damsizedice = 0</code>, so they
rely entirely on damroll. The dice calculation formulas exist but aren’t
used.</p>
<h4 id="migration-strategy-converting-damroll-to-damage-dice">Migration
Strategy: Converting Damroll to Damage Dice</h4>
<p><strong>Goal</strong>: Populate mob damage dice to match their
current effective damage output.</p>
<p><strong>Conversion Formula</strong>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current effective damage = damroll (fixed) + 0d0 (nothing)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Target: damroll_base + XdY where average matches current</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable split ratio based on dice size for optimal preservation</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> level <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    dice_size <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    fixed_pct <span class="op">=</span> <span class="fl">0.15</span>    <span class="co"># Keep 15% as fixed damroll</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    dice_size <span class="op">=</span> <span class="dv">8</span> <span class="cf">if</span> level <span class="op">&lt;</span> <span class="dv">60</span> <span class="cf">else</span> <span class="dv">10</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    fixed_pct <span class="op">=</span> <span class="fl">0.05</span>    <span class="co"># Keep 5% as fixed damroll</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>new_damroll <span class="op">=</span> FLOOR(current_damroll × fixed_pct)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>remaining <span class="op">=</span> current_damroll × (<span class="dv">1</span> <span class="op">-</span> fixed_pct)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate dice number to match average</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Average of XdY = X × (Y+1)/2, so X = (target_avg × 2) / (Y+1)</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>dice_number <span class="op">=</span> ROUND((remaining × <span class="dv">2</span>) <span class="op">/</span> (dice_size <span class="op">+</span> <span class="dv">1</span>))</span></code></pre></div>
<p><strong>Example Conversions</strong>:</p>
<pre><code>Level 20 mob with damroll=10:
  → damroll=1 + 3d4 (range: 4-13, avg: 8.5) [-15%]

Level 50 mob with damroll=10:
  → damroll=0 + 2d8 (range: 2-16, avg: 9.0) [-10%]

Level 60 mob with damroll=20:
  → damroll=1 + 3d10 (range: 4-31, avg: 17.5) [-12.5%]

Level 100 mob with damroll=26:
  → damroll=1 + 4d10 (range: 5-41, avg: 23.0) [-11.5%]</code></pre>
<p><strong>Damage Preservation</strong>: This formula maintains average
damage within 10-15% of original while adding appropriate variance. The
slight reduction accounts for damage dice variance benefits (critical
hits scale with dice, not damroll).</p>
<p><strong>SQL Migration Script</strong>:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> <span class="ot">&quot;Mobs&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  damage_dice_num <span class="op">=</span> <span class="fu">ROUND</span>((</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    damroll <span class="op">*</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="fl">0.85</span>  <span class="co">-- 85% to dice for d4</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ELSE</span> <span class="fl">0.95</span>                   <span class="co">-- 95% to dice for d8/d10</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="dv">5</span>  <span class="co">-- d4 average</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">60</span> <span class="cf">THEN</span> <span class="dv">9</span>  <span class="co">-- d8 average</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ELSE</span> <span class="dv">11</span>                  <span class="co">-- d10 average</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  damage_dice_size <span class="op">=</span> <span class="cf">CASE</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="dv">4</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">60</span> <span class="cf">THEN</span> <span class="dv">8</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ELSE</span> <span class="dv">10</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  damroll <span class="op">=</span> <span class="fu">FLOOR</span>(damroll <span class="op">*</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">WHEN</span> <span class="kw">level</span> <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="fl">0.15</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">ELSE</span> <span class="fl">0.05</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> damage_dice_num <span class="op">=</span> <span class="dv">0</span> <span class="kw">AND</span> damage_dice_size <span class="op">=</span> <span class="dv">0</span>;</span></code></pre></div>
<hr />
<h3 id="defensive-mechanics">1.3 Defensive Mechanics</h3>
<h4 id="damage-evasion-immunities">Damage Evasion (Immunities)</h4>
<p><strong>Source</strong>: <code>damage.cpp:55-119</code></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ether creatures evade physical damage unless blessed weapon</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (victim.composition <span class="op">==</span> ETHER <span class="op">&amp;&amp;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    damage_type <span class="kw">in</span> [PIERCE, SLASH, CRUSH] <span class="op">&amp;&amp;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>weapon_is_energy <span class="op">&amp;&amp;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>attacker.has_BLESS):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> true  <span class="co"># Complete evasion</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Evasion based on susceptibility</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> susceptibility(victim, damage_type)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For weapons with both physical and energy damage, use WORST susceptibility</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (weapon_has_energy_flag):</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">max</span>(physical_suscept, energy_suscept)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Evasion probability (cubic scaling)</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>evasion_chance <span class="op">=</span> (<span class="dv">100</span> <span class="op">-</span> s)³ <span class="op">/</span> <span class="dv">1</span>,<span class="dv">000</span>,<span class="dv">000</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples:</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># s=0 (immune):   100³/1M = 100% evasion</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># s=50 (resist):  50³/1M = 12.5% evasion</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># s=100 (normal): 0³/1M = 0% evasion</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># s=150 (vuln):   (-50)³/1M = 0% evasion (capped)</span></span></code></pre></div>
<h4 id="displacement-miss-chance">Displacement (Miss Chance)</h4>
<p><strong>Source</strong>: <code>fight.cpp:2587-2610</code></p>
<pre><code>if (EFF_DISPLACEMENT):
    20% chance to auto-miss (after hit calculation)

if (EFF_GREATER_DISPLACEMENT):
    33% chance to auto-miss (after hit calculation)</code></pre>
<h4 id="defensive-skills-post-hit-checks">Defensive Skills (Post-Hit
Checks)</h4>
<p><strong>Source</strong>: <code>fight.cpp:1816-1916</code></p>
<p>These proc AFTER a successful hit, in order: Riposte → Parry →
Dodge</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RIPOSTE</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> riposte_check(attacker, defender):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>defender.has_SKILL_RIPOSTE):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> false</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ch_hit <span class="op">=</span> random(<span class="dv">55</span>, <span class="dv">200</span>) <span class="op">+</span> attacker.hitroll <span class="op">-</span> monk_weight_penalty</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    vict_riposte <span class="op">=</span> random(<span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    vict_riposte <span class="op">+=</span> (defender.level <span class="op">-</span> attacker.level)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    vict_riposte <span class="op">-=</span> stat_bonus[defender.DEX].defense</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    vict_riposte <span class="op">+=</span> defender.skill_riposte × <span class="fl">0.085</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (vict_riposte <span class="op">&gt;</span> ch_hit):</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        defender.hit(attacker, SKILL_RIPOSTE)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> true  <span class="co"># Attack negated</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># PARRY</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parry_check(attacker, defender):</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    ch_hit <span class="op">=</span> random(<span class="dv">45</span>, <span class="dv">181</span>) <span class="op">+</span> attacker.hitroll <span class="op">-</span> monk_weight_penalty</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    vict_parry <span class="op">=</span> random(<span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    vict_parry <span class="op">+=</span> (defender.level <span class="op">-</span> attacker.level)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    vict_parry <span class="op">-=</span> stat_bonus[defender.DEX].defense</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    vict_parry <span class="op">+=</span> defender.skill_parry <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (vict_parry <span class="op">&gt;</span> ch_hit)  <span class="co"># Attack negated, no counter</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># DODGE</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dodge_check(attacker, defender):</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    ch_hit <span class="op">=</span> random(<span class="dv">35</span>, <span class="dv">171</span>) <span class="op">+</span> attacker.hitroll <span class="op">-</span> monk_weight_penalty</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    vict_dodge <span class="op">=</span> random(<span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    vict_dodge <span class="op">+=</span> (defender.level <span class="op">-</span> attacker.level)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    vict_dodge <span class="op">-=</span> stat_bonus[defender.DEX].defense</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    vict_dodge <span class="op">+=</span> defender.skill_dodge <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (vict_dodge <span class="op">&gt;</span> ch_hit)  <span class="co"># Attack negated, no counter</span></span></code></pre></div>
<p><strong>Note</strong>: These skills do NOT apply to Backstab, Kick,
or Barehand attacks.</p>
<h4 id="susceptibility-adjustment">Susceptibility Adjustment</h4>
<p><strong>Source</strong>: <code>damage.cpp</code> (not shown in
excerpt, but referenced)</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dam_suscept_adjust(attacker, victim, weapon, damage, dtype):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> susceptibility(victim, dtype)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Susceptibility modifies final damage</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># s &lt; 100: Resistant (damage reduced)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># s = 100: Normal damage</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># s &gt; 100: Vulnerable (damage increased)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> damage × (s <span class="op">/</span> <span class="dv">100</span>)</span></code></pre></div>
<hr />
<h3 id="combat-tempo-initiative">1.4 Combat Tempo &amp; Initiative</h3>
<p><strong>Source</strong>: <code>defines.hpp:316-323</code></p>
<h4 id="timing-constants">Timing Constants</h4>
<div class="sourceCode" id="cb21"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PASSES_PER_SEC </span><span class="op">(</span><span class="dv">1000000</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span>OPT_USEC<span class="op">)</span><span class="pp">  </span><span class="co">// Tick rate</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PULSE_VIOLENCE </span><span class="op">(</span><span class="dv">4</span><span class="pp"> </span>RL_SEC<span class="op">)</span><span class="pp">             </span><span class="co">// 4-second combat rounds</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PULSE_ZONE </span><span class="op">(</span><span class="dv">10</span><span class="pp"> </span>RL_SEC<span class="op">)</span><span class="pp">                </span><span class="co">// Zone resets</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PULSE_MOBILE </span><span class="op">(</span><span class="dv">10</span><span class="pp"> </span>RL_SEC<span class="op">)</span><span class="pp">              </span><span class="co">// Mob AI updates</span></span></code></pre></div>
<h4 id="combat-round-system">Combat Round System</h4>
<ul>
<li><strong>Round Duration</strong>: 4 seconds (PULSE_VIOLENCE)</li>
<li><strong>Attacks per Round</strong>: 1 for players (no multi-attack
by default)</li>
<li><strong>Mobs</strong>: 1 attack per round (unless special proc
grants extra)</li>
<li><strong>Initiative</strong>: Implicit (combat list iteration order
determines who goes first)</li>
</ul>
<h4 id="wait-states-action-economy">Wait States (Action Economy)</h4>
<p><strong>Source</strong>: <code>spell_parser.cpp:693-1542</code></p>
<pre><code>WAIT_STATE(ch, PULSE_VIOLENCE)        # 4 seconds (standard action)
WAIT_STATE(ch, PULSE_VIOLENCE × 1.5)  # 6 seconds (chants, performs)
WAIT_STATE(ch, PULSE_VIOLENCE × 2)    # 8 seconds (spell casting)
WAIT_STATE(ch, casting_time × PULSE_VIOLENCE / 2)  # Variable cast time</code></pre>
<hr />
<h3 id="spell-casting-saves">1.5 Spell Casting &amp; Saves</h3>
<p><strong>Source</strong>: <code>spell_parser.cpp</code> (excerpts)</p>
<h4 id="casting-time-formula">Casting Time Formula</h4>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (casting_time <span class="op">&gt;</span> <span class="dv">4</span>):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    wait_time <span class="op">=</span> casting_time × PULSE_VIOLENCE <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    wait_time <span class="op">=</span> PULSE_VIOLENCE × <span class="dv">2</span></span></code></pre></div>
<h4 id="spell-saves">Spell Saves</h4>
<p><strong>Source</strong>: Referenced in class.cpp saves arrays</p>
<pre><code>saves[5] = {para, rod, petri, breath, spell}</code></pre>
<table>
<thead>
<tr class="header">
<th>Class</th>
<th>Para</th>
<th>Rod</th>
<th>Petri</th>
<th>Breath</th>
<th>Spell</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sorcerer</td>
<td>90</td>
<td>85</td>
<td>95</td>
<td>105</td>
<td>80</td>
</tr>
<tr class="even">
<td>Cleric</td>
<td>85</td>
<td>110</td>
<td>85</td>
<td>115</td>
<td>90</td>
</tr>
<tr class="odd">
<td>Thief</td>
<td>95</td>
<td>90</td>
<td>100</td>
<td>110</td>
<td>110</td>
</tr>
<tr class="even">
<td>Warrior</td>
<td>105</td>
<td>115</td>
<td>100</td>
<td>100</td>
<td>110</td>
</tr>
</tbody>
</table>
<p><strong>Lower is better</strong> (target number to beat)</p>
<hr />
<h2 id="section-2-constant-tables">Section 2: Constant Tables</h2>
<h3 id="stat-bonus-tables-str-dex-con-int-wis">2.1 Stat Bonus Tables
(STR, DEX, CON, INT, WIS)</h3>
<p><strong>Source</strong>: <code>constants.cpp:291-369</code></p>
<h4 id="strength-str">Strength (STR)</h4>
<pre><code>Formula-based calculation (not hard-coded table):

ToHit:
  0-28:  linear from (0,-5) to (28,-1)  → tohit = (x/7) - 5
  29-64: 0
  65-100: linear from (65,1) to (100,7) → tohit = (6x/35) - (75/7)

ToDam:
  0-20:  linear from (0,-4) to (20,-1)  → todam = (3x/20) - 4
  21-60: 0
  61-100: linear from (61,1) to (100,14) → todam = (13x/39) - (754/39)

Carry:
  0-72:  linear from (0,0) to (72,300)  → carry = 300x/72
  73-100: linear from (73,300) to (100,786)

Wield:
  0-72:  linear from (0,0) to (72,20)   → wield = 5x/18
  73-100: linear from (73,40) to (100,70)</code></pre>
<table>
<thead>
<tr class="header">
<th>STR</th>
<th>ToHit</th>
<th>ToDam</th>
<th>Carry</th>
<th>Wield</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-5</td>
<td>-4</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>10</td>
<td>-4</td>
<td>-3</td>
<td>42</td>
<td>3</td>
</tr>
<tr class="odd">
<td>20</td>
<td>-2</td>
<td>-1</td>
<td>83</td>
<td>5</td>
</tr>
<tr class="even">
<td>30</td>
<td>-1</td>
<td>0</td>
<td>125</td>
<td>8</td>
</tr>
<tr class="odd">
<td>40</td>
<td>0</td>
<td>0</td>
<td>166</td>
<td>11</td>
</tr>
<tr class="even">
<td>50</td>
<td>0</td>
<td>0</td>
<td>208</td>
<td>14</td>
</tr>
<tr class="odd">
<td>60</td>
<td>0</td>
<td>0</td>
<td>250</td>
<td>16</td>
</tr>
<tr class="even">
<td>70</td>
<td>+2</td>
<td>+2</td>
<td>292</td>
<td>19</td>
</tr>
<tr class="odd">
<td>80</td>
<td>+3</td>
<td>+7</td>
<td>439</td>
<td>29</td>
</tr>
<tr class="even">
<td>90</td>
<td>+4</td>
<td>+9</td>
<td>596</td>
<td>40</td>
</tr>
<tr class="odd">
<td>100</td>
<td>+7</td>
<td>+14</td>
<td>786</td>
<td>70</td>
</tr>
</tbody>
</table>
<h4 id="dexterity-dex">Dexterity (DEX)</h4>
<pre><code>ToHit: Same as STR formula
ToDam: Same as STR formula

Defense (AC):
  0-24:  linear from (0,6) to (24,1)    → defense = (-5x/24) + 6
  25-56: 0
  57-100: linear from (57,-1) to (100,-6) → defense = (-5x/43) + (242/43)</code></pre>
<table>
<thead>
<tr class="header">
<th>DEX</th>
<th>ToHit</th>
<th>ToDam</th>
<th>Defense</th>
<th>AC Bonus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-5</td>
<td>-4</td>
<td>+6</td>
<td>+60</td>
</tr>
<tr class="even">
<td>20</td>
<td>-2</td>
<td>-1</td>
<td>+2</td>
<td>+20</td>
</tr>
<tr class="odd">
<td>40</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>60</td>
<td>0</td>
<td>0</td>
<td>-1</td>
<td>-10</td>
</tr>
<tr class="odd">
<td>80</td>
<td>+3</td>
<td>+7</td>
<td>-3</td>
<td>-30</td>
</tr>
<tr class="even">
<td>100</td>
<td>+7</td>
<td>+14</td>
<td>-6</td>
<td>-60</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: Defense × 10 = AC bonus (fight.cpp:2146)</p>
<h4 id="constitution-con">Constitution (CON)</h4>
<pre><code>HP Gain per Level:
  0-24:  linear from (0,-4) to (24,-1)  → hpgain = x/8 - 4
  25-56: 0
  57-96: linear from (57,1) to (96,5)   → hpgain = x/8 - (121/20)
  97-100: 5 (capped)</code></pre>
<table>
<thead>
<tr class="header">
<th>CON</th>
<th>HP/Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>-4</td>
</tr>
<tr class="even">
<td>20</td>
<td>-2</td>
</tr>
<tr class="odd">
<td>40</td>
<td>0</td>
</tr>
<tr class="even">
<td>60</td>
<td>+1</td>
</tr>
<tr class="odd">
<td>80</td>
<td>+3</td>
</tr>
<tr class="even">
<td>96</td>
<td>+5</td>
</tr>
<tr class="odd">
<td>100</td>
<td>+5</td>
</tr>
</tbody>
</table>
<h4 id="intelligence-int-wisdom-wis">Intelligence (INT) &amp; Wisdom
(WIS)</h4>
<pre><code>Magic Bonus:
  0-44:  0
  45-100: linear from (45,2) to (100,7) → magic = x/11 - (23/11)</code></pre>
<table>
<thead>
<tr class="header">
<th>INT/WIS</th>
<th>Magic</th>
<th>ToHit Contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-44</td>
<td>0</td>
<td>-0 to -18</td>
</tr>
<tr class="even">
<td>45</td>
<td>+2</td>
<td>-18</td>
</tr>
<tr class="odd">
<td>60</td>
<td>+3</td>
<td>-24</td>
</tr>
<tr class="even">
<td>80</td>
<td>+5</td>
<td>-32</td>
</tr>
<tr class="odd">
<td>100</td>
<td>+7</td>
<td>-40</td>
</tr>
</tbody>
</table>
<p><strong>ToHit</strong>: INT and WIS each contribute
<code>(4 × stat) / 10</code> to THAC0 reduction
(fight.cpp:2104-2106)</p>
<hr />
<h3 id="class-combat-modifiers">2.2 Class Combat Modifiers</h3>
<p><strong>Source</strong>: <code>class.cpp:56-288</code></p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 17%" />
<col style="width: 10%" />
<col style="width: 18%" />
<col style="width: 7%" />
<col style="width: 15%" />
<col style="width: 10%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="header">
<th>Class</th>
<th>HP/Lv 30+</th>
<th>THAC0</th>
<th>Exp Factor</th>
<th>HP%</th>
<th>Hit/Dam%</th>
<th>Dice%</th>
<th>AC%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sorcerer</td>
<td>+3</td>
<td>6</td>
<td>1.2</td>
<td>80</td>
<td>80</td>
<td>60</td>
<td>75</td>
</tr>
<tr class="even">
<td>Cleric</td>
<td>+6</td>
<td>4</td>
<td>1.0</td>
<td>80</td>
<td>80</td>
<td>70</td>
<td>100</td>
</tr>
<tr class="odd">
<td>Thief</td>
<td>+6</td>
<td>1</td>
<td>1.0</td>
<td>90</td>
<td>100</td>
<td>100</td>
<td>80</td>
</tr>
<tr class="even">
<td>Warrior</td>
<td>+10</td>
<td>-2</td>
<td>1.1</td>
<td>120</td>
<td>120</td>
<td>120</td>
<td>120</td>
</tr>
<tr class="odd">
<td>Paladin</td>
<td>+8</td>
<td>-2</td>
<td>1.15</td>
<td>120</td>
<td>120</td>
<td>120</td>
<td>120</td>
</tr>
<tr class="even">
<td>Ranger</td>
<td>+8</td>
<td>-2</td>
<td>1.15</td>
<td>120</td>
<td>120</td>
<td>120</td>
<td>120</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: These percentages apply to mob stat
generation, not player stats.</p>
<hr />
<h3 id="damage-types-susceptibility">2.3 Damage Types &amp;
Susceptibility</h3>
<p><strong>Source</strong>: <code>damage.cpp:26-39</code></p>
<table>
<thead>
<tr class="header">
<th>Damage Type</th>
<th>Color</th>
<th>Verb</th>
<th>Plural Verb</th>
<th>Noun</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SLASH</td>
<td>&amp;3</td>
<td>slash</td>
<td>slashes</td>
<td>slash</td>
</tr>
<tr class="even">
<td>PIERCE</td>
<td>&amp;3</td>
<td>pierce</td>
<td>pierces</td>
<td>slash</td>
</tr>
<tr class="odd">
<td>CRUSH</td>
<td>&amp;3</td>
<td>crush</td>
<td>crushes</td>
<td>crush</td>
</tr>
<tr class="even">
<td>SHOCK</td>
<td>&amp;4&amp;b</td>
<td>shock</td>
<td>shocks</td>
<td>shock</td>
</tr>
<tr class="odd">
<td>FIRE</td>
<td>&amp;1&amp;b</td>
<td>burn</td>
<td>burns</td>
<td>flame</td>
</tr>
<tr class="even">
<td>WATER</td>
<td>&amp;4</td>
<td>drown</td>
<td>drowns</td>
<td>flood</td>
</tr>
<tr class="odd">
<td>COLD</td>
<td>&amp;4</td>
<td>freeze</td>
<td>freezes</td>
<td>freeze</td>
</tr>
<tr class="even">
<td>ACID</td>
<td>&amp;2</td>
<td>corrode</td>
<td>corrodes</td>
<td>spray</td>
</tr>
<tr class="odd">
<td>POISON</td>
<td>&amp;2&amp;b</td>
<td>poison</td>
<td>poisons</td>
<td>poison</td>
</tr>
<tr class="even">
<td>HEAL</td>
<td>&amp;6</td>
<td>harm</td>
<td>harms</td>
<td>harm</td>
</tr>
<tr class="odd">
<td>ALIGN</td>
<td>&amp;6&amp;b</td>
<td>rebuke</td>
<td>rebukes</td>
<td>retribution</td>
</tr>
<tr class="even">
<td>DISPEL</td>
<td>&amp;5&amp;b</td>
<td>dispel</td>
<td>dispels</td>
<td>dispersion</td>
</tr>
<tr class="odd">
<td>DISCORPORATE</td>
<td>&amp;5</td>
<td>discorporate</td>
<td>discorporates</td>
<td>discorporation</td>
</tr>
<tr class="even">
<td>MENTAL</td>
<td>“”</td>
<td>punish</td>
<td>punishes</td>
<td>punishment</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="critical-hit-mechanics">2.4 Critical Hit Mechanics</h3>
<p><strong>Source</strong>: <code>fight.cpp:2214-2215</code></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple doubling on d200 == 20 (attack roll, not hit roll)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (diceroll <span class="op">==</span> <span class="dv">20</span>):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    dam × <span class="dv">2</span></span></code></pre></div>
<p><strong>Critical Chance</strong>: 1/200 = 0.5% <strong>Critical
Multiplier</strong>: 2× <strong>No special crit mechanics</strong> (no
increased chance, no variable multiplier)</p>
<hr />
<h3 id="weapon-proficiency-skills">2.5 Weapon Proficiency Skills</h3>
<p><strong>Source</strong>: <code>fight.cpp:2110-2114</code></p>
<pre><code>Weapon proficiency skill ranges 0-100
Applied as: THAC0 -= skill / 2

Max benefit: -50 THAC0 at 100 skill</code></pre>
<p><strong>Available Proficiencies</strong> (referenced in code): -
Various weapon types (swords, axes, maces, etc.) - Monk barehand
(replaces weapon prof if CLASS_MONK)</p>
<hr />
<h2 id="section-3-data-flow-diagram">Section 3: Data Flow Diagram</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                      MELEE ATTACK SEQUENCE                       │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐
│  ATTACKER    │
│  - Level     │
│  - Class     │
│  - STR/DEX   │
│  - INT/WIS   │
│  - Hitroll   │
│  - Damroll   │
│  - Weapon    │
│  - Skills    │
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 1: THAC0 CALCULATION                    │
│                                                                  │
│  Base THAC0 = calc_thac0(level, class.thac0_01, class.thac0_00) │
│  THAC0 = Base × 10                                               │
│  THAC0 -= stat_bonus[STR].tohit × 10   (or DEX for kick)        │
│  THAC0 -= hitroll                                                │
│  THAC0 -= (4 × INT) / 10                                         │
│  THAC0 -= (4 × WIS) / 10                                         │
│  THAC0 -= weapon_proficiency / 2   (if weapon)                   │
│  THAC0 -= barehand_skill / 2   (if monk, no weapon)              │
│  THAC0 -= alignment_bonus   (if blessed)                         │
│                                                                  │
│  Range: ~290 to -290                                             │
└─────────────────────────────────────────────────────────────────┘
       │
       ▼
┌──────────────┐      ┌─────────────────────────────────────────┐
│   DEFENDER   │      │      PHASE 2: DEFENDER AC               │
│  - AC        │ ───► │                                         │
│  - DEX       │      │  victim_AC = base_AC                    │
│  - Position  │      │  victim_AC += stat_bonus[DEX].defense×10│
│  - Stance    │      │  victim_AC = min(victim_AC, 100)        │
│  - Effects   │      │                                         │
└──────────────┘      │  Range: -160 to +100                    │
       │              └─────────────────────────────────────────┘
       │                     │
       │                     ▼
       │              ┌─────────────────────────────────────────┐
       │              │      PHASE 3: HIT DETERMINATION         │
       │              │                                         │
       │              │  diceroll = d200 (1-200)                │
       │              │                                         │
       │              │  if (diceroll &gt; 190 || !AWAKE):         │
       │              │      HIT = true   (auto-hit)            │
       │              │  elif (diceroll &lt; 11):                  │
       │              │      HIT = false  (auto-miss)           │
       │              │  else:                                  │
       │              │      HIT = (THAC0 - diceroll &lt;= AC)     │
       │              └─────────────────────────────────────────┘
       │                     │
       │                     ▼
       │              ┌─────────────────────────────────────────┐
       │              │      PHASE 4: EVASION CHECK             │
       │              │                                         │
       │              │  if (damage_evasion()):                 │
       │              │      return 0 damage  (immune)          │
       │              │                                         │
       │              │  if (displaced()):                      │
       │              │      return 0 damage  (20-33% miss)     │
       │              └─────────────────────────────────────────┘
       │                     │
       │                     ▼
       ▼              ┌─────────────────────────────────────────┐
  ┌────────────┐     │   PHASE 5: DEFENSIVE SKILLS (post-hit)  │
  │ MISS       │◄────┤                                         │
  │ damage=0   │     │  if (!riposte() &amp;&amp; !parry() &amp;&amp; !dodge())│
  └────────────┘     │      Continue to damage                 │
                     │  else:                                  │
                     │      Attack negated                     │
                     └─────────────────────────────────────────┘
                            │
                            ▼
                     ┌─────────────────────────────────────────┐
                     │      PHASE 6: BASE DAMAGE               │
                     │                                         │
                     │  dam = damroll + stat_bonus[STR].todam  │
                     │                                         │
                     │  if (diceroll == 20):                   │
                     │      dam × 2   (critical)               │
                     │                                         │
                     │  if (IS_NPC):                           │
                     │      dam += XdY (mob barehand)          │
                     │  if (weapon):                           │
                     │      dam += XdY (weapon dice)           │
                     │  else if (player):                      │
                     │      dam += random(0,2)                 │
                     └─────────────────────────────────────────┘
                            │
                            ▼
                     ┌─────────────────────────────────────────┐
                     │      PHASE 7: SKILL MODIFIERS           │
                     │                                         │
                     │  if (BACKSTAB):                         │
                     │      dam × (skill/10 + 1)               │
                     │  if (KICK):                             │
                     │      dam += skill/2 + DEX.todam         │
                     │  if (BAREHAND):                         │
                     │      dam += skill/4 + d(level/3) + lv/2 │
                     │  if (SPIRIT_BEAR):                      │
                     │      dam × (1 + level/1000)             │
                     │  if (BERSERK):                          │
                     │      dam × 1.1                          │
                     └─────────────────────────────────────────┘
                            │
                            ▼
                     ┌─────────────────────────────────────────┐
                     │      PHASE 8: STANCE MULTIPLIER         │
                     │                                         │
                     │  if (victim.stance &lt; FIGHTING):         │
                     │      dam × (1 + (7-stance)/3)           │
                     │                                         │
                     │  alert:1.33×, rest:1.66×, sleep:2×      │
                     │  stun:2.33×, incap:2.66×, mort:3×       │
                     └─────────────────────────────────────────┘
                            │
                            ▼
                     ┌─────────────────────────────────────────┐
                     │      PHASE 9: MITIGATION                │
                     │                                         │
                     │  if (STONE_SKIN &amp;&amp; 90% chance):         │
                     │      dam = random(0,3)                  │
                     │                                         │
                     │  dam = dam_suscept_adjust(dam, dtype)   │
                     │      → dam × (suscept / 100)            │
                     │                                         │
                     │  dam = max(1, dam)  (minimum)           │
                     └─────────────────────────────────────────┘
                            │
                            ▼
                     ┌─────────────────────────────────────────┐
                     │      PHASE 10: APPLY DAMAGE             │
                     │                                         │
                     │  victim.HP -= dam                       │
                     │                                         │
                     │  if (HP &lt;= 0):                          │
                     │      die(victim, attacker)              │
                     └─────────────────────────────────────────┘</code></pre>
<hr />
<h2 id="section-4-equation-sheet-latex-format">Section 4: Equation Sheet
(LaTeX Format)</h2>
<div class="sourceCode" id="cb32"><pre
class="sourceCode latex"><code class="sourceCode latex"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">\documentclass</span>{<span class="ex">article</span>}</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">amsmath</span>}</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\title</span>{FieryMUD Combat System - Complete Equation Reference}</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\author</span>{Reverse-Engineering Report}</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">document</span>}</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="kw">\section</span>{Hit Determination}</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{THAC0 Calculation}</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{THAC0}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} = </span><span class="sc">\text</span>{thac0}<span class="ss">_{01} + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{level}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> (</span><span class="sc">\text</span>{thac0}<span class="ss">_{00} - </span><span class="sc">\text</span>{thac0}<span class="ss">_{01})}{100}</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{THAC0}<span class="ss">_{</span><span class="sc">\text</span>{calc}<span class="ss">} &amp;= </span><span class="sc">\text</span>{THAC0}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} </span><span class="sc">\times</span><span class="ss"> 10 </span><span class="sc">\\</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\text</span>{stat<span class="sc">\_</span>bonus}<span class="ss">[</span><span class="sc">\text</span>{STR}<span class="ss">].</span><span class="sc">\text</span>{tohit}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> 10 </span><span class="sc">\\</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\text</span>{hitroll}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\frac</span><span class="ss">{4 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{INT}<span class="ss">}{10} </span><span class="sc">\\</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\frac</span><span class="ss">{4 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{WIS}<span class="ss">}{10} </span><span class="sc">\\</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{weapon<span class="sc">\_</span>proficiency}<span class="ss">}{2} </span><span class="sc">\\</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;- </span><span class="sc">\text</span>{alignment<span class="sc">\_</span>bonus}</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Defender AC}</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{AC}<span class="ss">_{</span><span class="sc">\text</span>{victim}<span class="ss">} &amp;= </span><span class="sc">\text</span>{AC}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} + </span><span class="sc">\text</span>{stat<span class="sc">\_</span>bonus}<span class="ss">[</span><span class="sc">\text</span>{DEX}<span class="ss">].</span><span class="sc">\text</span>{defense}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> 10 </span><span class="sc">\\</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{AC}<span class="ss">_{</span><span class="sc">\text</span>{victim}<span class="ss">} &amp;= </span><span class="sc">\min</span><span class="ss">(</span><span class="sc">\text</span>{AC}<span class="ss">_{</span><span class="sc">\text</span>{victim}<span class="ss">}, 100)</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Hit Probability}</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{HIT}<span class="ss"> =</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{true}<span class="ss"> &amp; </span><span class="sc">\text</span>{if }<span class="ss"> d_{200} &gt; 190 </span><span class="sc">\text</span>{ or }<span class="ss"> </span><span class="sc">\neg</span><span class="ss"> </span><span class="sc">\text</span>{AWAKE}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{false}<span class="ss"> &amp; </span><span class="sc">\text</span>{if }<span class="ss"> d_{200} &lt; 11 </span><span class="sc">\\</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{THAC0}<span class="ss">_{</span><span class="sc">\text</span>{calc}<span class="ss">} - d_{200} </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{AC}<span class="ss">_{</span><span class="sc">\text</span>{victim}<span class="ss">} &amp; </span><span class="sc">\text</span>{otherwise}</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="kw">\section</span>{Damage Calculation}</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Base Damage}</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} &amp;= </span><span class="sc">\text</span>{damroll}<span class="ss"> + </span><span class="sc">\text</span>{stat<span class="sc">\_</span>bonus}<span class="ss">[</span><span class="sc">\text</span>{STR}<span class="ss">].</span><span class="sc">\text</span>{todam}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{if }<span class="ss"> d_{200} &amp;= 20: </span><span class="sc">\quad</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} </span><span class="sc">\leftarrow</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} </span><span class="sc">\times</span><span class="ss"> 2</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Weapon Damage}</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{weapon}<span class="ss">} =</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{roll<span class="sc">\_</span>dice}<span class="ss">(</span><span class="sc">\text</span>{mob}<span class="ss">.</span><span class="sc">\text</span>{damnodice}<span class="ss">, </span><span class="sc">\text</span>{mob}<span class="ss">.</span><span class="sc">\text</span>{damsizedice}<span class="ss">) &amp; </span><span class="sc">\text</span>{if NPC}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{roll<span class="sc">\_</span>dice}<span class="ss">(</span><span class="sc">\text</span>{weapon}<span class="ss">.</span><span class="sc">\text</span>{dice<span class="sc">\_</span>num}<span class="ss">, </span><span class="sc">\text</span>{weapon}<span class="ss">.</span><span class="sc">\text</span>{dice<span class="sc">\_</span>size}<span class="ss">) &amp; </span><span class="sc">\text</span>{if weapon}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{random}<span class="ss">(0, 2) &amp; </span><span class="sc">\text</span>{if player, no weapon}</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Total Damage}</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{total}<span class="ss">} = </span><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{base}<span class="ss">} + </span><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{weapon}<span class="ss">}</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Skill Multipliers}</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{if BACKSTAB}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> &amp;</span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\leftarrow</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\left</span><span class="ss">( </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{skill}<span class="ss">}{10} + 1 </span><span class="sc">\right</span><span class="ss">) </span><span class="sc">\\</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{if KICK}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> &amp;</span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\leftarrow</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss"> + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{skill}<span class="ss">}{2} + </span><span class="sc">\text</span>{stat<span class="sc">\_</span>bonus}<span class="ss">[</span><span class="sc">\text</span>{DEX}<span class="ss">].</span><span class="sc">\text</span>{todam}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{if BAREHAND}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> &amp;</span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\leftarrow</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss"> + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{skill}<span class="ss">}{4} + </span><span class="sc">\text</span>{random}<span class="sc">\left</span><span class="ss">(1, </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{level}<span class="ss">}{3}</span><span class="sc">\right</span><span class="ss">) + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{level}<span class="ss">}{2}</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Stance Multiplier}</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{if stance}<span class="ss"> &lt; </span><span class="sc">\text</span>{FIGHTING}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\leftarrow</span><span class="ss"> </span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\left</span><span class="ss">( 1 + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{FIGHTING}<span class="ss"> - </span><span class="sc">\text</span>{stance}<span class="ss">}{3} </span><span class="sc">\right</span><span class="ss">)</span></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Susceptibility Adjustment}</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{dam}<span class="ss">_{</span><span class="sc">\text</span>{final}<span class="ss">} = </span><span class="sc">\max\left</span><span class="ss">(1, </span><span class="sc">\text</span>{dam}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{susceptibility}<span class="ss">}{100}</span><span class="sc">\right</span><span class="ss">)</span></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a><span class="kw">\section</span>{Defensive Mechanics}</span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Evasion Probability}</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a><span class="ss">P(</span><span class="sc">\text</span>{evade}<span class="ss">) = </span><span class="sc">\frac</span><span class="ss">{(100 - </span><span class="sc">\text</span>{susceptibility}<span class="ss">)^3}{1,000,000}</span></span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Riposte Check}</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{ch<span class="sc">\_</span>hit}<span class="ss"> &amp;= </span><span class="sc">\text</span>{random}<span class="ss">(55, 200) + </span><span class="sc">\text</span>{hitroll}<span class="ss"> - </span><span class="sc">\text</span>{monk<span class="sc">\_</span>penalty}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{vict<span class="sc">\_</span>riposte}<span class="ss"> &amp;= </span><span class="sc">\text</span>{random}<span class="ss">(20, 50) + (</span><span class="sc">\text</span>{level}<span class="ss">_{</span><span class="sc">\text</span>{def}<span class="ss">} - </span><span class="sc">\text</span>{level}<span class="ss">_{</span><span class="sc">\text</span>{att}<span class="ss">}) </span><span class="sc">\\</span></span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;</span><span class="sc">\quad</span><span class="ss"> - </span><span class="sc">\text</span>{stat<span class="sc">\_</span>bonus}<span class="ss">[</span><span class="sc">\text</span>{DEX}<span class="ss">].</span><span class="sc">\text</span>{defense}<span class="ss"> + </span><span class="sc">\text</span>{skill}<span class="ss"> </span><span class="sc">\times</span><span class="ss"> 0.085 </span><span class="sc">\\</span></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{success}<span class="ss"> &amp;= (</span><span class="sc">\text</span>{vict<span class="sc">\_</span>riposte}<span class="ss"> &gt; </span><span class="sc">\text</span>{ch<span class="sc">\_</span>hit}<span class="ss">)</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Parry/Dodge Checks}</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">align</span>}</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{parry}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> </span><span class="sc">\text</span>{ch<span class="sc">\_</span>hit}<span class="ss"> &amp;= </span><span class="sc">\text</span>{random}<span class="ss">(45, 181) + </span><span class="sc">\text</span>{modifiers}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{dodge}<span class="ss">: </span><span class="sc">\quad</span><span class="ss"> </span><span class="sc">\text</span>{ch<span class="sc">\_</span>hit}<span class="ss"> &amp;= </span><span class="sc">\text</span>{random}<span class="ss">(35, 171) + </span><span class="sc">\text</span>{modifiers}<span class="ss"> </span><span class="sc">\\</span></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{vict<span class="sc">\_</span>def}<span class="ss"> &amp;= </span><span class="sc">\text</span>{random}<span class="ss">(20, 50) + </span><span class="sc">\text</span>{modifiers}<span class="ss"> + </span><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{skill}<span class="ss">}{10} </span><span class="sc">\\</span></span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{success}<span class="ss"> &amp;= (</span><span class="sc">\text</span>{vict<span class="sc">\_</span>def}<span class="ss"> &gt; </span><span class="sc">\text</span>{ch<span class="sc">\_</span>hit}<span class="ss">)</span></span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">align</span>}</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a><span class="kw">\section</span>{Stat Bonuses}</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Strength - ToHit}</span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{tohit}<span class="ss">(</span><span class="sc">\text</span>{STR}<span class="ss">) =</span></span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{STR}<span class="ss">}{7} - 5 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 0 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 28 </span><span class="sc">\\</span></span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a><span class="ss">0 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 29 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 64 </span><span class="sc">\\</span></span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{6 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss">}{35} - </span><span class="sc">\frac</span><span class="ss">{75}{7} &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 65 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 100</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Strength - ToDam}</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{todam}<span class="ss">(</span><span class="sc">\text</span>{STR}<span class="ss">) =</span></span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{3 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss">}{20} - 4 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 0 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 20 </span><span class="sc">\\</span></span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a><span class="ss">0 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 21 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 60 </span><span class="sc">\\</span></span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{13 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss">}{39} - </span><span class="sc">\frac</span><span class="ss">{754}{39} &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 61 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{STR}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 100</span></span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Dexterity - Defense}</span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{defense}<span class="ss">(</span><span class="sc">\text</span>{DEX}<span class="ss">) =</span></span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{-5 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{DEX}<span class="ss">}{24} + 6 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 0 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{DEX}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 24 </span><span class="sc">\\</span></span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a><span class="ss">0 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 25 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{DEX}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 56 </span><span class="sc">\\</span></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{-5 </span><span class="sc">\times</span><span class="ss"> </span><span class="sc">\text</span>{DEX}<span class="ss">}{43} + </span><span class="sc">\frac</span><span class="ss">{242}{43} &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 57 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{DEX}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 100</span></span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a><span class="kw">\subsection</span>{Constitution - HP Gain}</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">equation</span>}</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a><span class="sc">\text</span>{hpgain}<span class="ss">(</span><span class="sc">\text</span>{CON}<span class="ss">) =</span></span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">cases</span>}</span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{CON}<span class="ss">}{8} - 4 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 0 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{CON}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 24 </span><span class="sc">\\</span></span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a><span class="ss">0 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 25 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{CON}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 56 </span><span class="sc">\\</span></span>
<span id="cb32-143"><a href="#cb32-143" aria-hidden="true" tabindex="-1"></a><span class="sc">\frac</span><span class="ss">{</span><span class="sc">\text</span>{CON}<span class="ss">}{8} - </span><span class="sc">\frac</span><span class="ss">{121}{20} &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 57 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{CON}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 96 </span><span class="sc">\\</span></span>
<span id="cb32-144"><a href="#cb32-144" aria-hidden="true" tabindex="-1"></a><span class="ss">5 &amp; </span><span class="sc">\text</span>{if }<span class="ss"> 97 </span><span class="sc">\leq</span><span class="ss"> </span><span class="sc">\text</span>{CON}<span class="ss"> </span><span class="sc">\leq</span><span class="ss"> 100</span></span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">cases</span>}</span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">equation</span>}</span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">document</span>}</span></code></pre></div>
<hr />
<h2 id="section-5-modern-system-mapping-proposal">Section 5: Modern
System Mapping Proposal</h2>
<h3 id="core-concept-opposed-rolls-bounded-accuracy">5.1 Core Concept:
Opposed Rolls → Bounded Accuracy</h3>
<p><strong>Problem with Current System</strong>: - THAC0 and AC can
reach extreme values (-290 to +100 for AC alone) - Hit rates become
binary (0% or 100%) at level extremes - No soft caps, no meaningful
choice at high levels</p>
<p><strong>Proposed Solution</strong>:</p>
<pre><code>OLD: THAC0 - d200 ≤ AC
NEW: ACC + d100 vs EVA + d100</code></pre>
<h3 id="attribute-mapping">5.2 Attribute Mapping</h3>
<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 36%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th>Old System</th>
<th>New System</th>
<th>Formula</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>THAC0 (level, class, hitroll, stats, skills)</td>
<td><strong>ACC</strong> (Accuracy)</td>
<td>See 5.3</td>
</tr>
<tr class="even">
<td>AC (base, DEX, gear)</td>
<td><strong>EVA</strong> (Evasion)</td>
<td>See 5.4</td>
</tr>
<tr class="odd">
<td>Damroll + STR + weapon dice</td>
<td><strong>AP</strong> (Attack Power) +
<strong>WeaponBase</strong></td>
<td>See 5.5</td>
</tr>
<tr class="even">
<td>AC (armor only)</td>
<td><strong>AR</strong> (Armor Rating) → <strong>DR%</strong></td>
<td>See 5.6</td>
</tr>
<tr class="odd">
<td>(none)</td>
<td><strong>Soak</strong> (flat damage reduction)</td>
<td>See 5.7</td>
</tr>
<tr class="even">
<td>(none)</td>
<td><strong>Pen%</strong> (% armor penetration)</td>
<td>See 5.8</td>
</tr>
<tr class="odd">
<td>Stone Skin, Susceptibility</td>
<td><strong>DR%</strong>, <strong>Resist%</strong></td>
<td>See 5.9</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="acc-accuracy-formula">5.3 ACC (Accuracy) Formula</h3>
<p><strong>Goal</strong>: Convert THAC0 components into a bounded
accuracy score (0-200 range)</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base accuracy from level and class</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ACC_base <span class="op">=</span> <span class="dv">50</span> <span class="op">+</span> (level × class_acc_rate)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Class ACC rates (replaces THAC0)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>class_acc_rates <span class="op">=</span> {</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;SORCERER&#39;</span>: <span class="fl">0.3</span>,   <span class="co"># Reaches 80 ACC at level 100</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;CLERIC&#39;</span>: <span class="fl">0.4</span>,     <span class="co"># Reaches 90 ACC at level 100</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;THIEF&#39;</span>: <span class="fl">0.5</span>,      <span class="co"># Reaches 100 ACC at level 100</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;WARRIOR&#39;</span>: <span class="fl">0.6</span>,    <span class="co"># Reaches 110 ACC at level 100</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;PALADIN&#39;</span>: <span class="fl">0.6</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;RANGER&#39;</span>: <span class="fl">0.6</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add stat bonuses (converted from THAC0 tohit)</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">+=</span> (STR <span class="op">-</span> <span class="dv">50</span>) <span class="op">/</span> <span class="dv">5</span>  <span class="co"># -10 to +10</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">+=</span> (INT <span class="op">-</span> <span class="dv">50</span>) <span class="op">/</span> <span class="dv">10</span>  <span class="co"># -5 to +5</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">+=</span> (WIS <span class="op">-</span> <span class="dv">50</span>) <span class="op">/</span> <span class="dv">10</span>  <span class="co"># -5 to +5</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add gear hitroll (1:1 conversion)</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">+=</span> hitroll  <span class="co"># Up to +40 from gear</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add weapon proficiency</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">+=</span> weapon_proficiency <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Up to +50 from skill</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Soft cap at 200</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>ACC <span class="op">=</span> <span class="bu">min</span>(<span class="dv">200</span>, ACC)</span></code></pre></div>
<p><strong>Example</strong> (Level 50 Warrior, STR 80, INT 60, WIS 60,
hitroll +20, prof 80):</p>
<pre><code>ACC = 50 + (50 × 0.6) + (80-50)/5 + (60-50)/10 + (60-50)/10 + 20 + 40
ACC = 50 + 30 + 6 + 1 + 1 + 20 + 40 = 148</code></pre>
<hr />
<h3 id="eva-evasion-formula">5.4 EVA (Evasion) Formula</h3>
<p><strong>Goal</strong>: Convert AC into an evasion score (0-150
range)</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base evasion from level (grows slower than ACC)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>EVA_base <span class="op">=</span> <span class="dv">30</span> <span class="op">+</span> (level × <span class="fl">0.3</span>)  <span class="co"># 30-60 at levels 0-100</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add DEX bonus (converted from defense)</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>EVA <span class="op">+=</span> (DEX <span class="op">-</span> <span class="dv">50</span>) <span class="op">/</span> <span class="dv">3</span>  <span class="co"># -16 to +16</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add dodge/parry/riposte skills (merged into EVA)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>EVA <span class="op">+=</span> (dodge_skill <span class="op">/</span> <span class="dv">5</span>)  <span class="co"># Up to +20</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>EVA <span class="op">+=</span> (parry_skill <span class="op">/</span> <span class="dv">5</span>)  <span class="co"># Up to +20</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>EVA <span class="op">+=</span> (riposte_skill <span class="op">/</span> <span class="dv">10</span>)  <span class="co"># Up to +10</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Soft cap at 150</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>EVA <span class="op">=</span> <span class="bu">min</span>(<span class="dv">150</span>, EVA)</span></code></pre></div>
<p><strong>Example</strong> (Level 50 Mob, DEX 70, dodge 60, parry 40,
riposte 0):</p>
<pre><code>EVA = 30 + (50 × 0.3) + (70-50)/3 + 12 + 8 + 0
EVA = 30 + 15 + 6.7 + 12 + 8 = 71.7 ≈ 72</code></pre>
<hr />
<h3 id="hit-chance-calculation-opposed-d100-rolls">5.5 Hit Chance
Calculation (Opposed d100 Rolls)</h3>
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hit(attacker, defender):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    attacker_roll <span class="op">=</span> d100() <span class="op">+</span> attacker.ACC</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    defender_roll <span class="op">=</span> d100() <span class="op">+</span> defender.EVA</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Natural 1 always misses, natural 100 always hits</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attacker_roll_natural <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attacker_roll_natural <span class="op">==</span> <span class="dv">100</span>:</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Opposed roll</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> attacker_roll <span class="op">-</span> defender_roll</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> margin <span class="op">&gt;=</span> <span class="dv">50</span>:</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;CRITICAL_HIT&#39;</span>  <span class="co"># 2× damage</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> margin <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;HIT&#39;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> margin <span class="op">&gt;=</span> <span class="op">-</span><span class="dv">10</span>:</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;GLANCING&#39;</span>  <span class="co"># 50% damage</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;MISS&#39;</span></span></code></pre></div>
<p><strong>Expected Hit Rates</strong> (ACC vs EVA): | ACC-EVA Diff |
Hit% | Crit% | Glance% | Miss% | |————–|——|——-|———|——-| | -50 | 15% | 0%
| 5% | 80% | | -25 | 30% | 2% | 10% | 58% | | 0 | 50% | 5% | 20% | 25% |
| +25 | 70% | 12% | 18% | 0% | | +50 | 85% | 25% | 10% | 0% |</p>
<hr />
<h3 id="armor-rating-damage-reduction">5.6 Armor Rating → Damage
Reduction %</h3>
<p><strong>Goal</strong>: Convert AC (from armor only) into % damage
reduction</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract armor AC from total AC</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>armor_AC <span class="op">=</span> total_AC <span class="op">-</span> DEX_bonus <span class="op">-</span> magic_AC</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Armor Rating (AR)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Invert scale: lower AC = higher AR</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>AR <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="dv">100</span> <span class="op">-</span> armor_AC)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate DR% using diminishing returns formula</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> tier_constant(defender.level)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>DR_percent <span class="op">=</span> AR <span class="op">/</span> (AR <span class="op">+</span> K)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Tier constants (controls DR% scaling)</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>tier_constants <span class="op">=</span> {</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;LOW&#39;</span> (<span class="dv">1</span><span class="op">-</span><span class="dv">20</span>):   K <span class="op">=</span> <span class="dv">50</span>   <span class="co"># AR 50 → 50% DR</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;MID&#39;</span> (<span class="dv">21</span><span class="op">-</span><span class="dv">50</span>):  K <span class="op">=</span> <span class="dv">75</span>   <span class="co"># AR 75 → 50% DR</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;HIGH&#39;</span> (<span class="dv">51</span><span class="op">-</span><span class="dv">99</span>): K <span class="op">=</span> <span class="dv">100</span>  <span class="co"># AR 100 → 50% DR</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Example</strong> (Level 50 Warrior, armor AC -40):</p>
<pre><code>AR = 100 - (-40) = 140
K = 75 (mid-tier)
DR% = 140 / (140 + 75) = 140 / 215 = 65.1%</code></pre>
<p><strong>DR% Cap</strong>: 75% (prevents invincibility)</p>
<hr />
<h3 id="soak-flat-damage-reduction">5.7 Soak (Flat Damage
Reduction)</h3>
<p><strong>New Mechanic</strong>: Flat reduction applied BEFORE
percentage reduction</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Soak from heavy armor and shields</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>soak <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> armor.<span class="bu">type</span> <span class="op">==</span> <span class="st">&#39;PLATE&#39;</span>:</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    soak <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> armor.<span class="bu">type</span> <span class="op">==</span> <span class="st">&#39;CHAIN&#39;</span>:</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    soak <span class="op">+=</span> <span class="dv">3</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> armor.<span class="bu">type</span> <span class="op">==</span> <span class="st">&#39;LEATHER&#39;</span>:</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    soak <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> shield.equipped:</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    soak <span class="op">+=</span> shield.armor_value <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Applied before DR%</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>damage_after_soak <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, damage <span class="op">-</span> soak)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>damage_final <span class="op">=</span> damage_after_soak × (<span class="dv">1</span> <span class="op">-</span> DR<span class="op">%</span>)</span></code></pre></div>
<hr />
<h3 id="armor-penetration-ap-and-pen">5.8 Armor Penetration (AP) and
Pen%</h3>
<p><strong>Counter-mechanic</strong>: Attackers reduce defender’s
mitigation</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flat penetration (reduces Soak)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>AP <span class="op">=</span> damroll_from_gear</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage penetration (reduces DR%)</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>Pen_percent <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> weapon.<span class="bu">type</span> <span class="op">==</span> <span class="st">&#39;PIERCING&#39;</span>:</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    Pen_percent <span class="op">+=</span> <span class="dv">20</span><span class="op">%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> weapon.has_flag(<span class="st">&#39;ARMOR_PIERCING&#39;</span>):</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    Pen_percent <span class="op">+=</span> <span class="dv">15</span><span class="op">%</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Application</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>effective_soak <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, soak <span class="op">-</span> AP)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>effective_DR <span class="op">=</span> DR_percent × (<span class="dv">1</span> <span class="op">-</span> Pen_percent)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>damage_after_soak <span class="op">=</span> damage <span class="op">-</span> effective_soak</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>damage_final <span class="op">=</span> damage_after_soak × (<span class="dv">1</span> <span class="op">-</span> effective_DR)</span></code></pre></div>
<hr />
<h3 id="damage-formula-modern-system">5.9 Damage Formula (Modern
System)</h3>
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_damage(attacker, defender, hit_type):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base damage</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">=</span> attacker.weapon.base_damage  <span class="co"># Flat value from weapon</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> roll_dice(weapon.dice_num, weapon.dice_size)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Attack Power (replaces damroll + STR)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> attacker.AP</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skill multipliers (preserved from legacy)</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> skill <span class="op">==</span> <span class="st">&#39;BACKSTAB&#39;</span>:</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        dam × (backstab_skill <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> skill <span class="op">==</span> <span class="st">&#39;BAREHAND&#39;</span>:</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        dam <span class="op">+=</span> barehand_skill<span class="op">/</span><span class="dv">4</span> <span class="op">+</span> d(level<span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> level<span class="op">/</span><span class="dv">2</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hit type multiplier</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hit_type <span class="op">==</span> <span class="st">&#39;CRITICAL&#39;</span>:</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>        dam × <span class="dv">2</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> hit_type <span class="op">==</span> <span class="st">&#39;GLANCING&#39;</span>:</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        dam × <span class="fl">0.5</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply penetration</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    effective_soak <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, defender.soak <span class="op">-</span> attacker.AP)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    effective_DR <span class="op">=</span> defender.DR_percent × (<span class="dv">1</span> <span class="op">-</span> attacker.Pen_percent)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply mitigation</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    dam_after_soak <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, dam <span class="op">-</span> effective_soak)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    dam_final <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, dam_after_soak × (<span class="dv">1</span> <span class="op">-</span> effective_DR))</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Susceptibility (preserved)</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    dam_final × (susceptibility <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dam_final</span></code></pre></div>
<hr />
<h3 id="mob-damage-use-per-mob-dice">5.10 Mob Damage: Use Per-Mob
Dice</h3>
<p><strong>Current System</strong> (already implemented):</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">// fight.cpp:2218-2219</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>IS_NPC<span class="op">(</span>ch<span class="op">))</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    dam <span class="op">+=</span> roll_dice<span class="op">(</span>ch<span class="op">-&gt;</span>mob_specials<span class="op">.</span>damnodice<span class="op">,</span> ch<span class="op">-&gt;</span>mob_specials<span class="op">.</span>damsizedice<span class="op">);</span></span></code></pre></div>
<p><strong>Proposal</strong>: Keep this, remove any global mob damage
charts</p>
<p><strong>Migration</strong>: 1. Ensure all mobs in database have
<code>damage_dice_num</code> and <code>damage_dice_size</code> populated
2. Set reasonable values by mob level tier: - L1-10: 1d4 to 2d4 -
L11-25: 2d6 to 3d6 - L26-50: 3d8 to 5d8 - L51-75: 5d10 to 8d10 - L76-99:
8d12 to 12d12</p>
<hr />
<h2 id="section-6-calibration-report">Section 6: Calibration Report</h2>
<h3 id="test-matrix-5-players-5-mobs">6.1 Test Matrix: 5 Players × 5
Mobs</h3>
<h4 id="player-archetypes">Player Archetypes</h4>
<p><strong>P1</strong>: Level 20 Warrior (STR 80, DEX 60, AC -20,
hitroll +15, damroll +10, weapon 2d6) <strong>P2</strong>: Level 20
Sorcerer (INT 90, WIS 70, AC +10, hitroll +5, damroll +3, weapon 1d4)
<strong>P3</strong>: Level 50 Warrior (STR 90, DEX 70, AC -60, hitroll
+30, damroll +25, weapon 3d8) <strong>P4</strong>: Level 50 Thief (DEX
90, STR 70, AC -40, hitroll +25, damroll +15, weapon 2d6)
<strong>P5</strong>: Level 80 Paladin (STR 95, CON 85, AC -80, hitroll
+35, damroll +30, weapon 4d8)</p>
<h4 id="mob-archetypes">Mob Archetypes</h4>
<p><strong>M1</strong>: Level 20 Mob (AC -10, hitroll +10, dam 2d6+5, HP
200) <strong>M2</strong>: Level 20 Boss (AC -30, hitroll +20, dam
3d8+10, HP 400) <strong>M3</strong>: Level 50 Mob (AC -40, hitroll +25,
dam 4d8+15, HP 600) <strong>M4</strong>: Level 50 Elite (AC -60, hitroll
+35, dam 5d10+20, HP 900) <strong>M5</strong>: Level 80 Boss (AC -100,
hitroll +50, dam 8d12+40, HP 1500)</p>
<h3 id="current-system-calculations">6.2 Current System
Calculations</h3>
<h4 id="p1-l20-warrior-vs-m1-l20-mob">P1 (L20 Warrior) vs M1 (L20
Mob)</h4>
<p><strong>Hit Chance</strong>:</p>
<pre><code>THAC0_base = calc_thac0(20, 20, -2) = 20 + 20×(-22)/100 = 15.6
THAC0_calc = 15.6 × 10 - (3×10) - 15 - 16 - 16 - 25 = 156 - 30 - 15 - 16 - 16 - 25 = 54

victim_AC = -10 + (0×10) = -10

# Hit if: 54 - d200 ≤ -10
# Hit if: d200 ≥ 64

P(auto-miss) = 10/200 = 5%
P(auto-hit) = 10/200 = 5%
P(calculated hit) = (200-64)/180 × 90% = 136/180 × 90% = 68%

Total hit% = 5% + 68% = 73%</code></pre>
<p><strong>Damage</strong>:</p>
<pre><code>Base: 10 (damroll) + 7 (STR 80) = 17
Weapon: 2d6 avg = 7
Total avg damage = 17 + 7 = 24

Critical (0.5% chance): 48

Average DPH (damage per hit) = 24 × 0.995 + 48 × 0.005 = 24.12
DPS = 24.12 × 0.73 / 4 = 4.40 per second
TTK = 200 / 4.40 = 45.5 seconds</code></pre>
<h4 id="p3-l50-warrior-vs-m3-l50-mob">P3 (L50 Warrior) vs M3 (L50
Mob)</h4>
<p><strong>Hit Chance</strong>:</p>
<pre><code>THAC0_base = calc_thac0(50, 20, -2) = 20 + 50×(-22)/100 = 9
THAC0_calc = 9×10 - (4×10) - 30 - 20 - 20 - 30 = 90 - 40 - 30 - 20 - 20 - 30 = -50

victim_AC = -40 + (2×10) = -20

# Hit if: -50 - d200 ≤ -20
# Solving: -d200 ≤ 30
# Hit if: d200 ≥ -30  (ALWAYS TRUE for positive rolls)

# Auto-miss (1-10): 5%
# Calculated (11-190): 90% (all hit since d200 ≥ -30 always true)
# Auto-hit (191-200): 5%

Total hit% = 95%</code></pre>
<p><strong>Damage</strong>:</p>
<pre><code>Base: 25 + 9 = 34
Weapon: 3d8 avg = 13.5
Total avg = 47.5

Critical (0.5% chance): 95

Average DPH (damage per hit) = 47.5 × 0.995 + 95 × 0.005 = 47.74
DPS = 47.74 × 0.95 / 4 = 11.33 per second
TTK = 600 / 11.33 = 53.0 seconds</code></pre>
<p><strong>NOTE</strong>: Level 50 Warriors hit 95% of the time against
equal-level mobs - the current system works correctly at this level</p>
<h3 id="modern-system-calculations">6.3 Modern System Calculations</h3>
<h4 id="p1-l20-warrior-vs-m1-l20-mob-1">P1 (L20 Warrior) vs M1 (L20
Mob)</h4>
<p><strong>ACC/EVA</strong>:</p>
<pre><code>P1 ACC = 50 + (20×0.6) + (80-50)/5 + (60-50)/10 + 15 + 25 = 50 + 12 + 6 + 1 + 15 + 25 = 109

M1 EVA = 30 + (20×0.3) + (50-50)/3 = 30 + 6 + 0 = 36

ACC - EVA = 109 - 36 = +73</code></pre>
<p><strong>Hit Chance</strong> (from table, ACC-EVA = +73 ≈ +50+):</p>
<pre><code>Hit% ≈ 85%
Crit% ≈ 25%</code></pre>
<p><strong>Damage</strong>:</p>
<pre><code>Base: 20 (weapon) + 2d6 (avg 7) + 15 (AP from damroll) = 42

M1 AR = 100 - (-10) = 110
DR% = 110 / (110 + 50) = 68.75%

Soak = 0 (mob has no armor)

Normal hit: 42 × (1 - 0.6875) = 13.1
Critical hit: 42 × 2 × (1 - 0.6875) = 26.2

DPH = 13.1 × 0.60 + 26.2 × 0.25 = 7.86 + 6.55 = 14.41
DPS = 14.41 × 0.85 / 4 = 3.06 per second
TTK = 200 / 3.06 = 65.4 seconds</code></pre>
<p><strong>Comparison</strong>: - Current hit%: 73% → New hit%: 85%
(+12%) - Current DPS: 4.40 → New DPS: 3.06 (-30%) - Current TTK: 45.5s →
New TTK: 65.4s (+44%)</p>
<p><strong>Issue</strong>: New system reduces DPS too much. Need
adjustment.</p>
<h4 id="p3-l50-warrior-vs-m3-l50-mob-1">P3 (L50 Warrior) vs M3 (L50
Mob)</h4>
<p><strong>ACC/EVA</strong>:</p>
<pre><code>P3 ACC = 50 + (50×0.6) + (90-50)/5 + (70-50)/10 + 30 + 40 = 50 + 30 + 8 + 2 + 30 + 40 = 160

M3 EVA = 30 + (50×0.3) + (60-50)/3 = 30 + 15 + 3.3 = 48.3

ACC - EVA = 160 - 48.3 = +111.7</code></pre>
<p><strong>Hit Chance</strong>:</p>
<pre><code>Easily in 95%+ range (soft cap)
Crit% ≈ 40%</code></pre>
<p><strong>Damage</strong>:</p>
<pre><code>Base: 30 (weapon) + 3d8 (avg 13.5) + 30 (AP) = 73.5

M3 AR = 100 - (-40) = 140
DR% = 140 / (140 + 75) = 65.1%

Normal hit: 73.5 × (1 - 0.651) = 25.7
Critical hit: 73.5 × 2 × (1 - 0.651) = 51.4

DPH = 25.7 × 0.55 + 51.4 × 0.40 = 14.1 + 20.6 = 34.7
DPS = 34.7 × 0.95 / 4 = 8.24 per second
TTK = 600 / 8.24 = 72.8 seconds</code></pre>
<p><strong>Comparison</strong>: - Current hit%: 95% → New hit%: 95% (0%)
- Current DPS: 11.33 → New DPS: 8.24 (-27%) - Current TTK: 53.0s → New
TTK: 72.8s (+37%)</p>
<p><strong>Result</strong>: New system is slower at level 50. Current
system performs well at this level.</p>
<h3 id="calibration-adjustments">6.4 Calibration Adjustments</h3>
<p><strong>Findings</strong>: 1. Low-level (20) fights are ~30-40%
slower in new system 2. Mid-level (50) fights are ~30-40% slower in new
system (current system works well) 3. High-level (80) needs testing but
should be in range</p>
<p><strong>Proposed Knob Adjustments</strong>:</p>
<ol type="1">
<li><p><strong>Reduce K constants</strong> (increase DR% scaling):</p>
<pre><code>OLD: K_low=50, K_mid=75, K_high=100
NEW: K_low=40, K_mid=60, K_high=80</code></pre></li>
<li><p><strong>Increase weapon base damage</strong>:</p>
<pre><code>All weapons +20% base damage</code></pre></li>
<li><p><strong>Add proficiency to AP</strong>:</p>
<pre><code>AP = damroll + (weapon_proficiency / 5)</code></pre></li>
<li><p><strong>Adjust ACC rates slightly</strong>:</p>
<pre><code>Warrior: 0.6 → 0.65
Thief: 0.5 → 0.55</code></pre></li>
</ol>
<p>With these adjustments, re-running P1 vs M1:</p>
<pre><code>DR% = 110 / (110 + 40) = 73.3%
Base damage: 20×1.2 + 7 + 15 + 5 = 51

Normal: 51 × (1 - 0.733) = 13.6
DPH = 13.6 × 0.60 + 27.2 × 0.25 = 8.16 + 6.8 = 14.96
DPS = 14.96 × 0.85 / 4 = 3.18
TTK = 200 / 3.18 = 62.9s

Deviation from current: +38% (acceptable given we&#39;re fixing L50+ pathology)</code></pre>
<hr />
<h2 id="section-7-edge-cases-migration">Section 7: Edge Cases &amp;
Migration</h2>
<h3 id="edge-case-audit">7.1 Edge Case Audit</h3>
<h4 id="backstabpositionals">Backstab/Positionals</h4>
<p><strong>Current</strong>: dam × (skill/10 + 1)
<strong>Proposed</strong>: Keep multiplier, apply AFTER mitigation
<strong>Reason</strong>: Prevents one-shotting high-DR targets</p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLD</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> base_dam × backstab_mult</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> apply_mitigation(dam)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> apply_mitigation(base_dam)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>dam <span class="op">=</span> dam × backstab_mult</span></code></pre></div>
<h4 id="dual-wieldoffhand">Dual-Wield/Offhand</h4>
<p><strong>Current</strong>: No explicit dual-wield in base system
(skill-based) <strong>Proposed</strong>: Second attack at 50% AP,
separate hit roll <strong>Implementation</strong>:</p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dual_wield_skill <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    offhand_ACC <span class="op">=</span> main_ACC <span class="op">-</span> <span class="dv">30</span> <span class="op">+</span> (skill <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    offhand_AP <span class="op">=</span> main_AP × <span class="fl">0.5</span></span></code></pre></div>
<h4 id="size-modifiers">Size Modifiers</h4>
<p><strong>Current</strong>: No explicit size-based hit modifiers
<strong>Proposed</strong>: Tiny targets +20 EVA, Huge targets -20
EVA</p>
<h4 id="immunities">Immunities</h4>
<p><strong>Current</strong>: Evasion based on susceptibility (0-100
scale) <strong>Proposed</strong>: Keep evasion formula, but add explicit
IMMUNE flag for 100% evasion</p>
<h4 id="minimum-damage">Minimum Damage</h4>
<p><strong>Current</strong>: max(1, dam) <strong>Proposed</strong>:
max(1, dam) after ALL modifiers</p>
<h4 id="stone-skin">Stone Skin</h4>
<p><strong>Current</strong>: 90% chance to reduce dam to random(0,3)
<strong>Proposed</strong>: +50% DR (stacks multiplicatively with armor
DR)</p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>total_DR <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> armor_DR) × (<span class="dv">1</span> <span class="op">-</span> stoneskin_DR)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: 50% armor + 50% stoneskin = 75% total DR</span></span></code></pre></div>
<hr />
<h3 id="migration-worksheet-csv-format">7.2 Migration Worksheet (CSV
Format)</h3>
<pre class="csv"><code>Entity,Old_Stat,Old_Value,New_Stat,New_Value,Conversion_Formula
Player,THAC0,-50,ACC,120,&quot;50 + level×0.6 + conversions&quot;
Player,Hitroll,+30,ACC,+30,&quot;1:1 add to ACC&quot;
Player,AC,-60,EVA,80,&quot;Inverse + level scaling&quot;
Player,Damroll,+25,AP,+25,&quot;1:1 to AP&quot;
Warrior,HP/Level,+10,HP/Level,+10,&quot;No change&quot;
Warrior,THAC0_00,-2,ACC_rate,0.65,&quot;Class rate&quot;
Sorcerer,THAC0_00,6,ACC_rate,0.30,&quot;Class rate&quot;
Mob_L20,AC,-10,AR,110,&quot;100 - AC&quot;
Mob_L20,Hitroll,+10,ACC,95,&quot;30 + level×0.3 + 10&quot;
Mob_L20,DamDice,2d6+5,Base+Dice,12+2d6,&quot;Split into base + dice&quot;
Plate_Armor,AC,-20,AR+Soak,120+5,&quot;AR from AC, +5 soak&quot;
Longsword,Dice,2d6,Base+Dice,15+2d6,&quot;Add base damage&quot;
Shield,AC,-5,Soak,+3,&quot;Convert AC to soak&quot;</code></pre>
<h3 id="constants-export-json">7.3 Constants Export (JSON)</h3>
<div class="sourceCode" id="cb64"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0&quot;</span><span class="fu">,</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;combat_constants&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;timing&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;combat_round_seconds&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;passes_per_second&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;auto_miss_low&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;auto_miss_high&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;auto_hit_low&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;auto_hit_high&quot;</span><span class="fu">:</span> <span class="dv">100</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hit_calculation&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;acc_base&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;eva_base&quot;</span><span class="fu">:</span> <span class="dv">30</span><span class="fu">,</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;acc_level_rate&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;WARRIOR&quot;</span><span class="fu">:</span> <span class="fl">0.65</span><span class="fu">,</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;PALADIN&quot;</span><span class="fu">:</span> <span class="fl">0.65</span><span class="fu">,</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;RANGER&quot;</span><span class="fu">:</span> <span class="fl">0.65</span><span class="fu">,</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;THIEF&quot;</span><span class="fu">:</span> <span class="fl">0.55</span><span class="fu">,</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;CLERIC&quot;</span><span class="fu">:</span> <span class="fl">0.40</span><span class="fu">,</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;SORCERER&quot;</span><span class="fu">:</span> <span class="fl">0.30</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;eva_level_rate&quot;</span><span class="fu">:</span> <span class="fl">0.3</span><span class="fu">,</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;acc_soft_cap&quot;</span><span class="fu">:</span> <span class="dv">200</span><span class="fu">,</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;eva_soft_cap&quot;</span><span class="fu">:</span> <span class="dv">150</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;damage_reduction&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;dr_k_constants&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;low_tier&quot;</span><span class="fu">:</span> <span class="dv">40</span><span class="fu">,</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;mid_tier&quot;</span><span class="fu">:</span> <span class="dv">60</span><span class="fu">,</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;high_tier&quot;</span><span class="fu">:</span> <span class="dv">80</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;dr_cap&quot;</span><span class="fu">:</span> <span class="fl">0.75</span><span class="fu">,</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;soak_armor_types&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;PLATE&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;CHAIN&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;LEATHER&quot;</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;penetration&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;weapon_pen_percent&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;PIERCING&quot;</span><span class="fu">:</span> <span class="fl">0.20</span><span class="fu">,</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;SLASHING&quot;</span><span class="fu">:</span> <span class="fl">0.10</span><span class="fu">,</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;CRUSHING&quot;</span><span class="fu">:</span> <span class="fl">0.05</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;armor_piercing_flag&quot;</span><span class="fu">:</span> <span class="fl">0.15</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;critical_hits&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;margin_for_crit&quot;</span><span class="fu">:</span> <span class="dv">50</span><span class="fu">,</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;crit_multiplier&quot;</span><span class="fu">:</span> <span class="fl">2.0</span><span class="fu">,</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;glancing_margin&quot;</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">,</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;glancing_multiplier&quot;</span><span class="fu">:</span> <span class="fl">0.5</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;stat_bonuses&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;STR_to_ACC&quot;</span><span class="fu">:</span> <span class="fl">0.2</span><span class="fu">,</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;DEX_to_EVA&quot;</span><span class="fu">:</span> <span class="fl">0.33</span><span class="fu">,</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;INT_to_ACC&quot;</span><span class="fu">:</span> <span class="fl">0.1</span><span class="fu">,</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;WIS_to_ACC&quot;</span><span class="fu">:</span> <span class="fl">0.1</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;skill_multipliers&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;backstab&quot;</span><span class="fu">:</span> <span class="st">&quot;skill/10 + 1&quot;</span><span class="fu">,</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;kick&quot;</span><span class="fu">:</span> <span class="st">&quot;skill/2 + DEX.todam&quot;</span><span class="fu">,</span></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;barehand&quot;</span><span class="fu">:</span> <span class="st">&quot;skill/4 + d(level/3) + level/2&quot;</span><span class="fu">,</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;weapon_proficiency_to_ACC&quot;</span><span class="fu">:</span> <span class="fl">0.5</span><span class="fu">,</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;weapon_proficiency_to_AP&quot;</span><span class="fu">:</span> <span class="fl">0.2</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;stance_multipliers&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;FIGHTING&quot;</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;ALERT&quot;</span><span class="fu">:</span> <span class="fl">1.33</span><span class="fu">,</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;RESTING&quot;</span><span class="fu">:</span> <span class="fl">1.66</span><span class="fu">,</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;SLEEPING&quot;</span><span class="fu">:</span> <span class="fl">2.0</span><span class="fu">,</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;STUNNED&quot;</span><span class="fu">:</span> <span class="fl">2.33</span><span class="fu">,</span></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;INCAP&quot;</span><span class="fu">:</span> <span class="fl">2.66</span><span class="fu">,</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;MORT&quot;</span><span class="fu">:</span> <span class="fl">3.0</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;calibration_targets&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hit_rate_low_tier&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;min&quot;</span><span class="fu">:</span> <span class="fl">0.60</span><span class="fu">,</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;median&quot;</span><span class="fu">:</span> <span class="fl">0.75</span><span class="fu">,</span></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="fl">0.90</span></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hit_rate_mid_tier&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;min&quot;</span><span class="fu">:</span> <span class="fl">0.65</span><span class="fu">,</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;median&quot;</span><span class="fu">:</span> <span class="fl">0.80</span><span class="fu">,</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="fl">0.95</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hit_rate_high_tier&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;min&quot;</span><span class="fu">:</span> <span class="fl">0.70</span><span class="fu">,</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;median&quot;</span><span class="fu">:</span> <span class="fl">0.85</span><span class="fu">,</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="fl">0.95</span></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;ttk_deviation_max&quot;</span><span class="fu">:</span> <span class="fl">0.10</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="appendix-code-references">Appendix: Code References</h2>
<h3 id="fileline-index">File:Line Index</h3>
<pre><code>fight.cpp:2089-2161    Hit chance calculation (THAC0)
fight.cpp:2585         calc_thac0() function
fight.cpp:2207-2287    Damage calculation
fight.cpp:2244-2271    Skill multipliers
fight.cpp:1816-1916    Riposte/Parry/Dodge
fight.cpp:2587-2610    Displacement check
damage.cpp:55-119      Damage evasion
damage.cpp:121-161     Weapon damage type conversion
constants.cpp:291-369  Stat bonus formulas
class.cpp:56-288       Class definitions
defines.hpp:316-323    Timing constants
defines.hpp:26-35      Stance/Position constants
spell_parser.cpp:1523  Casting time wait states</code></pre>
<hr />
<p><strong>End of Reverse-Engineering Report</strong></p>
<hr />
<h2 id="next-steps">Next Steps</h2>
<ol type="1">
<li><strong>Validation</strong>: Run full test suite on all 25
player/mob combinations</li>
<li><strong>Tuning</strong>: Adjust K constants and base damages to hit
calibration targets</li>
<li><strong>Implementation</strong>: Port formulas to new combat
system</li>
<li><strong>Testing</strong>: 100+ combat logs comparing old vs new</li>
<li><strong>Migration</strong>: Database scripts to convert AC → AR,
damroll → AP, etc.</li>
</ol>
<p><strong>Questions for Discussion</strong>: - Should we preserve
stance multipliers or reduce them? - Glancing blows: good addition or
unnecessary complexity? - Soak values: too low, too high? - Dual-wield:
separate system or merged into proficiency?</p>
</body>
</html>
